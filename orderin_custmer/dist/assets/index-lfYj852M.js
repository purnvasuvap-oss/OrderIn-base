import{u as ie,r as l,j as e,a as Ze,b as ve,A as et,c as _e,d as tt,R as qe,X as Ae,F as rt,C as Pe,e as at,f as nt,H as st,M as Te,P as Ee,g as ot,S as ct,h as He,i as Fe,k as it,T as lt,W as dt,l as ut,B as mt,N as Je,m as pt,n as le,o as gt,p as ht}from"./react-DBivmkpb.js";import{i as ft,a as yt,b as xt,g as bt,c as vt,d as jt,e as St,f as te,h as ae,s as ce,j as pe,k as wt,r as Me,l as Ue,m as Le,n as Re,o as Ve,u as Ge,p as je}from"./firebase-D6HzvLr8.js";import{h as Nt}from"./pdf-BiJ8Tr99.js";import"./vendor-T49Lvism.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const c of u)if(c.type==="childList")for(const v of c.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&i(v)}).observe(document,{childList:!0,subtree:!0});function s(u){const c={};return u.integrity&&(c.integrity=u.integrity),u.referrerPolicy&&(c.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?c.credentials="include":u.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(u){if(u.ep)return;u.ep=!0;const c=s(u);fetch(u.href,c)}})();var Se={};const It={apiKey:"AIzaSyAk-pLesgCvvG2yoq22IgU575l_NkjfddA",authDomain:"orderin-7f8bc.firebaseapp.com",projectId:"orderin-7f8bc",storageBucket:"orderin-7f8bc.firebasestorage.app",messagingSenderId:"977042319750",appId:"1:977042319750:web:4a44dec8cd6aa49e69a407",measurementId:"G-L7XE4PHWSW"},he=ft(It),Ct=(()=>{try{const r=yt(he,{persistence:[xt]});console.info("Firebase Auth initialized with initializeAuth");try{const s=!!(typeof window<"u"&&window.location&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")||process&&Se&&!1);Object.defineProperty(r,"appVerificationDisabledForTesting",{value:s,writable:!0,configurable:!0,enumerable:!0}),console.info("appVerificationDisabledForTesting property defined =",s)}catch(t){console.warn("Could not set appVerificationDisabledForTesting property",t)}return r}catch(r){console.info("Auth already initialized, using getAuth:",r.message);const t=bt(he);try{const i=!!(typeof window<"u"&&window.location&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")||typeof process<"u"&&Se&&!1);Object.defineProperty(t,"appVerificationDisabledForTesting",{value:i,writable:!0,configurable:!0,enumerable:!0})}catch(s){console.warn("Could not set appVerificationDisabledForTesting on fallback auth",s)}return console.info("Auth from getAuth:",typeof t),t}})();console.info("firebaseConfig: auth object exported");console.info("firebaseConfig: auth object exported");const Z=vt(he);(()=>{try{return jt(he)}catch(r){return console.info("Firebase Analytics not initialized:",(r==null?void 0:r.message)||r),null}})();(async function(){try{if(typeof window>"u")return;const t=window.location&&window.location.hostname,s=typeof process<"u"&&Se&&Se.REACT_APP_AUTH_EMULATOR==="true"||window.localStorage&&window.localStorage.getItem&&window.localStorage.getItem("useAuthEmulator")==="1"||window.location&&window.location.search&&window.location.search.indexOf("useEmulator=1")!==-1;if(!(t==="localhost"||t==="127.0.0.1")||!s)return;const i="http://localhost:9099/",u=async()=>{try{const v=await fetch(i,{method:"GET",cache:"no-store"});return v&&v.ok}catch{return!1}};if(await Promise.race([u(),new Promise(v=>setTimeout(()=>v(!1),800))]))try{St(Ct,"http://localhost:9099",{disableWarnings:!0}),console.info("Connected Firebase Auth emulator at http://localhost:9099")}catch(v){console.info("Failed to connect to Auth emulator:",(v==null?void 0:v.message)||v)}else console.info("Auth emulator not reachable at http://localhost:9099; skipping emulator connection")}catch(t){console.info("Auth emulator probe error:",(t==null?void 0:t.message)||t)}})();const kt=()=>{const r=ie(),[t,s]=l.useState(""),[i,u]=l.useState(""),[c,v]=l.useState("+91"),[C,A]=l.useState(!1),[E,U]=l.useState(""),[J,M]=l.useState(!1),[P,I]=l.useState(""),[k,m]=l.useState(0),[S,h]=l.useState(!1),[y,w]=l.useState(null),[L,D]=l.useState(null),[d,p]=l.useState("");l.useEffect(()=>{(async()=>{try{const O=te(Z,"Restaurant","orderin_restaurant_1"),T=await ae(O);if(T.exists()){const B=T.data();w(B.status||null),D(B.inactiveTimestamp||null)}else w(null),D(null)}catch{w(null),D(null),p("Could not fetch restaurant status. Please try again later.")}})()},[]),l.useEffect(()=>{const f=B=>{if(!B.target)return;console.log("Input focused:",B.target.name||B.target.placeholder),B.target.scrollIntoView({behavior:"instant",block:"center"});const q=setTimeout(()=>{B.target.scrollIntoView({behavior:"smooth",block:"center"}),console.log("Delayed scroll to focused input")},100),_=setTimeout(()=>{B.target.scrollIntoView({behavior:"instant",block:"center"}),console.log("Extra scroll to ensure visibility")},500);return()=>{clearTimeout(q),clearTimeout(_)}},O=()=>{console.log("Input blurred")},T=document.querySelectorAll('input[type="text"], input[type="tel"], input[type="password"], input[type="email"], input[type="number"]');return T.forEach(B=>{B.addEventListener("focus",f),B.addEventListener("blur",O)}),()=>{T.forEach(B=>{B.removeEventListener("focus",f),B.removeEventListener("blur",O)})}},[]),l.useEffect(()=>{if(!k)return;const f=setInterval(()=>{m(O=>O<=1?(clearInterval(f),0):O-1)},1e3);return()=>clearInterval(f)},[k]);const W=async(f,O)=>{try{const T=te(Z,"Restaurant","orderin_restaurant_1","customers",f),B=await ae(T),q=new Date().toISOString();let _=[],a=[];if(B.exists()){const N=B.data();_=N.names||[],a=N.loginHistory||[],_.includes(O)||_.push(O),a.push(q)}return B.exists()?(await ce(T,{phone:f,names:_,loginHistory:a,updatedAt:pe()},{merge:!0}),{success:!0}):(await ce(T,{phone:f,names:[O],loginHistory:[q],likedItems:[],pastOrders:[],feedback:[],createdAt:pe(),updatedAt:pe()}),{success:!0})}catch(T){return console.error("Error saving user to Firestore:",T),{success:!1,error:T.message}}},F=async()=>{if(y==="Off"||y==="Inactive"&&(!L||Date.now()-L>7200*60*1e3)){I(y==="Off"?"Login is currently disabled. Restaurant is Off.":y==="Inactive"?"Login is only allowed for 5 days after Inactive. Please contact the restaurant.":"Login is currently disabled. Please try again later.");return}if(i.trim()===""){I("Please enter phone number");return}if(t.trim()===""){I("Please enter your name");return}M(!0),I("");try{const f=`${c}${i}`,O=await W(f,t);if(O.success){const T={username:t,phone:f};localStorage.setItem("user",JSON.stringify(T)),localStorage.setItem("tableNumber",window.tableNumber||"1"),alert(`Welcome ${t}!`),r(`/menu?table=${window.tableNumber||"1"}`)}else I(`Error saving user: ${O.error}`)}catch(f){I(`Error: ${(f==null?void 0:f.message)||f}`)}finally{M(!1)}},R=[{code:"+1",country:"United States"},{code:"+7",country:"Russia"},{code:"+20",country:"Egypt"},{code:"+27",country:"South Africa"},{code:"+30",country:"Greece"},{code:"+31",country:"Netherlands"},{code:"+32",country:"Belgium"},{code:"+33",country:"France"},{code:"+34",country:"Spain"},{code:"+36",country:"Hungary"},{code:"+39",country:"Italy"},{code:"+40",country:"Romania"},{code:"+41",country:"Switzerland"},{code:"+43",country:"Austria"},{code:"+44",country:"United Kingdom"},{code:"+45",country:"Denmark"},{code:"+46",country:"Sweden"},{code:"+47",country:"Norway"},{code:"+48",country:"Poland"},{code:"+49",country:"Germany"},{code:"+51",country:"Peru"},{code:"+52",country:"Mexico"},{code:"+53",country:"Cuba"},{code:"+54",country:"Argentina"},{code:"+55",country:"Brazil"},{code:"+56",country:"Chile"},{code:"+57",country:"Colombia"},{code:"+58",country:"Venezuela"},{code:"+60",country:"Malaysia"},{code:"+61",country:"Australia"},{code:"+62",country:"Indonesia"},{code:"+63",country:"Philippines"},{code:"+64",country:"New Zealand"},{code:"+65",country:"Singapore"},{code:"+66",country:"Thailand"},{code:"+81",country:"Japan"},{code:"+82",country:"South Korea"},{code:"+84",country:"Vietnam"},{code:"+86",country:"China"},{code:"+90",country:"Turkey"},{code:"+91",country:"India"},{code:"+92",country:"Pakistan"},{code:"+93",country:"Afghanistan"},{code:"+94",country:"Sri Lanka"},{code:"+95",country:"Myanmar"},{code:"+98",country:"Iran"},{code:"+212",country:"Morocco"},{code:"+213",country:"Algeria"},{code:"+216",country:"Tunisia"},{code:"+218",country:"Libya"},{code:"+220",country:"Gambia"},{code:"+221",country:"Senegal"},{code:"+222",country:"Mauritania"},{code:"+223",country:"Mali"},{code:"+224",country:"Guinea"},{code:"+225",country:"Ivory Coast"},{code:"+226",country:"Burkina Faso"},{code:"+227",country:"Niger"},{code:"+228",country:"Togo"},{code:"+229",country:"Benin"},{code:"+230",country:"Mauritius"},{code:"+231",country:"Liberia"},{code:"+232",country:"Sierra Leone"},{code:"+233",country:"Ghana"},{code:"+234",country:"Nigeria"},{code:"+235",country:"Chad"},{code:"+236",country:"Central African Republic"},{code:"+237",country:"Cameroon"},{code:"+238",country:"Cape Verde"},{code:"+239",country:"Sao Tome and Principe"},{code:"+240",country:"Equatorial Guinea"},{code:"+241",country:"Gabon"},{code:"+242",country:"Republic of the Congo"},{code:"+243",country:"Democratic Republic of the Congo"},{code:"+244",country:"Angola"},{code:"+245",country:"Guinea-Bissau"},{code:"+246",country:"British Indian Ocean Territory"},{code:"+248",country:"Seychelles"},{code:"+249",country:"Sudan"},{code:"+250",country:"Rwanda"},{code:"+251",country:"Ethiopia"},{code:"+252",country:"Somalia"},{code:"+253",country:"Djibouti"},{code:"+254",country:"Kenya"},{code:"+255",country:"Tanzania"},{code:"+256",country:"Uganda"},{code:"+257",country:"Burundi"},{code:"+258",country:"Mozambique"},{code:"+260",country:"Zambia"},{code:"+261",country:"Madagascar"},{code:"+262",country:"Reunion"},{code:"+263",country:"Zimbabwe"},{code:"+264",country:"Namibia"},{code:"+265",country:"Malawi"},{code:"+266",country:"Lesotho"},{code:"+267",country:"Botswana"},{code:"+268",country:"Swaziland"},{code:"+269",country:"Comoros"},{code:"+290",country:"Saint Helena"},{code:"+291",country:"Eritrea"},{code:"+297",country:"Aruba"},{code:"+298",country:"Faroe Islands"},{code:"+299",country:"Greenland"},{code:"+350",country:"Gibraltar"},{code:"+351",country:"Portugal"},{code:"+352",country:"Luxembourg"},{code:"+353",country:"Ireland"},{code:"+354",country:"Iceland"},{code:"+355",country:"Albania"},{code:"+356",country:"Malta"},{code:"+357",country:"Cyprus"},{code:"+358",country:"Finland"},{code:"+359",country:"Bulgaria"},{code:"+370",country:"Lithuania"},{code:"+371",country:"Latvia"},{code:"+372",country:"Estonia"},{code:"+373",country:"Moldova"},{code:"+374",country:"Armenia"},{code:"+375",country:"Belarus"},{code:"+376",country:"Andorra"},{code:"+377",country:"Monaco"},{code:"+378",country:"San Marino"},{code:"+380",country:"Ukraine"},{code:"+381",country:"Serbia"},{code:"+382",country:"Montenegro"},{code:"+383",country:"Kosovo"},{code:"+385",country:"Croatia"},{code:"+386",country:"Slovenia"},{code:"+387",country:"Bosnia and Herzegovina"},{code:"+389",country:"Macedonia"},{code:"+420",country:"Czech Republic"},{code:"+421",country:"Slovakia"},{code:"+423",country:"Liechtenstein"},{code:"+500",country:"Falkland Islands"},{code:"+501",country:"Belize"},{code:"+502",country:"Guatemala"},{code:"+503",country:"El Salvador"},{code:"+504",country:"Honduras"},{code:"+505",country:"Nicaragua"},{code:"+506",country:"Costa Rica"},{code:"+507",country:"Panama"},{code:"+508",country:"Saint Pierre and Miquelon"},{code:"+509",country:"Haiti"},{code:"+590",country:"Guadeloupe"},{code:"+591",country:"Bolivia"},{code:"+592",country:"Guyana"},{code:"+593",country:"Ecuador"},{code:"+594",country:"French Guiana"},{code:"+595",country:"Paraguay"},{code:"+596",country:"Martinique"},{code:"+597",country:"Suriname"},{code:"+598",country:"Uruguay"},{code:"+599",country:"Netherlands Antilles"},{code:"+670",country:"East Timor"},{code:"+672",country:"Antarctica"},{code:"+673",country:"Brunei"},{code:"+674",country:"Nauru"},{code:"+675",country:"Papua New Guinea"},{code:"+676",country:"Tonga"},{code:"+677",country:"Solomon Islands"},{code:"+678",country:"Vanuatu"},{code:"+679",country:"Fiji"},{code:"+680",country:"Palau"},{code:"+681",country:"Wallis and Futuna"},{code:"+682",country:"Cook Islands"},{code:"+683",country:"Niue"},{code:"+684",country:"American Samoa"},{code:"+685",country:"Samoa"},{code:"+686",country:"Kiribati"},{code:"+687",country:"New Caledonia"},{code:"+688",country:"Tuvalu"},{code:"+689",country:"French Polynesia"},{code:"+690",country:"Tokelau"},{code:"+691",country:"Micronesia"},{code:"+692",country:"Marshall Islands"},{code:"+850",country:"North Korea"},{code:"+852",country:"Hong Kong"},{code:"+853",country:"Macau"},{code:"+855",country:"Cambodia"},{code:"+856",country:"Laos"},{code:"+880",country:"Bangladesh"},{code:"+886",country:"Taiwan"},{code:"+960",country:"Maldives"},{code:"+961",country:"Lebanon"},{code:"+962",country:"Jordan"},{code:"+963",country:"Syria"},{code:"+964",country:"Iraq"},{code:"+965",country:"Kuwait"},{code:"+966",country:"Saudi Arabia"},{code:"+967",country:"Yemen"},{code:"+968",country:"Oman"},{code:"+970",country:"Palestine"},{code:"+971",country:"United Arab Emirates"},{code:"+972",country:"Israel"},{code:"+973",country:"Bahrain"},{code:"+974",country:"Qatar"},{code:"+975",country:"Bhutan"},{code:"+976",country:"Mongolia"},{code:"+977",country:"Nepal"},{code:"+992",country:"Tajikistan"},{code:"+993",country:"Turkmenistan"},{code:"+994",country:"Azerbaijan"},{code:"+995",country:"Georgia"},{code:"+996",country:"Kyrgyzstan"},{code:"+998",country:"Uzbekistan"}].filter(f=>f.code.toLowerCase().includes(E.toLowerCase())||f.country.toLowerCase().includes(E.toLowerCase()));return e.jsxs("div",{className:"login-container",children:[J&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading..."})]}),e.jsxs("div",{className:"login-box",children:[e.jsx("img",{src:"/OrderIn.png",alt:"OrderIn",className:"orderin-logo"}),e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Enter your name",value:t,onChange:f=>s(f.target.value)}),e.jsxs("div",{className:"phone-input-container",children:[e.jsxs("div",{className:"country-code-wrapper",children:[e.jsx("input",{type:"text",className:"country-code-selector",placeholder:"+91",value:c,onChange:f=>{v(f.target.value),U(f.target.value)},onClick:()=>A(!C),onFocus:()=>A(!0),onBlur:()=>setTimeout(()=>A(!1),200)}),C&&e.jsx("div",{className:"country-dropdown",children:e.jsx("div",{className:"dropdown-list",children:R.map(f=>e.jsxs("div",{className:"dropdown-item",onClick:()=>{v(f.code),A(!1),U("")},children:[f.code," - ",f.country]},f.code))})})]}),e.jsx("input",{type:"tel",className:"phone-input",placeholder:"Enter phone number",value:i,onChange:f=>u(f.target.value)})]}),P&&e.jsx("div",{style:{color:"red",marginBottom:"10px",fontSize:"14px",textAlign:"center"},children:P}),e.jsx("button",{onClick:F,className:"login-btn",disabled:J||!!d||y===null,style:d||y===null?{background:"#ccc",cursor:"not-allowed"}:{},children:d?"Status Error":y===null?"Checking status...":J?"Logging in...":"Login"})]})]})]})},ue=()=>{const[r]=Ze(),[t,s]=l.useState(null);return l.useEffect(()=>{const u=r.get("table");if(u)s(u),localStorage.setItem("tableNumber",u);else{const c=localStorage.getItem("tableNumber")||"1";s(c)}},[r]),{tableNumber:t,getPathWithTable:u=>{const c=t||localStorage.getItem("tableNumber")||"1";return`${u}?table=${c}`}}};function re(r="No Image",t=400,s=300,i="#eeeeee",u="#888888"){const c=String(r||"").replace(/</g,"&lt;").replace(/>/g,"&gt;"),v=`<svg xmlns='http://www.w3.org/2000/svg' width='${t}' height='${s}' viewBox='0 0 ${t} ${s}'><rect width='100%' height='100%' fill='${i}'/><text x='50%' y='50%' font-family='Arial, Helvetica, sans-serif' font-size='20' fill='${u}' dominant-baseline='middle' text-anchor='middle'>${c}</text></svg>`;return`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(v)}`}const Ke="storage_resolver_cache_v1",ye=new Map,Ot=()=>{try{const r=localStorage.getItem(Ke);if(!r)return new Map;const t=JSON.parse(r);return new Map(Object.entries(t))}catch{return new Map}},Oe=r=>{try{localStorage.setItem(Ke,JSON.stringify(Object.fromEntries(r.entries())))}catch{}};let fe=Ot();for(const[r,t]of fe.entries())ye.set(r,t);const _t=()=>{try{return he&&he.options&&he.options.storageBucket?he.options.storageBucket:null}catch{return null}},Pt=async(r,t)=>{if(!r||!t)return null;try{const s=`https://firebasestorage.googleapis.com/v0/b/${r}/o/${encodeURIComponent(t)}?alt=media`;return(await fetch(s,{method:"HEAD"})).ok?s:null}catch{return null}},de=async r=>{if(!r)return null;if(r.startsWith("http://")||r.startsWith("https://"))return r;if(ye.has(r))return ye.get(r);const t=wt(),s=_t();if(r.startsWith("gs://"))try{const u=r.match(/^gs:\/\/[^\/]+\/(.+)$/);if(!u)return null;const c=u[1],v=Me(t,c),C=await Ue(v);return ye.set(r,C),fe.set(r,C),Oe(fe),C}catch(u){console.warn("resolveImageUrl(gs://) failed, will try public URL fallback",r,u)}const i=r.startsWith("/")?r.slice(1):r;if(i.indexOf("/")!==-1)try{const u=Me(t,i),c=await Ue(u);return ye.set(r,c),fe.set(r,c),Oe(fe),c}catch(u){console.warn("resolveImageUrl(relative path) getDownloadURL failed, trying public URL",r,u);const c=await Pt(s,i);return c?(ye.set(r,c),fe.set(r,c),Oe(fe),c):null}return null},Ye=l.createContext(),ge=()=>l.useContext(Ye),Ne={save(r,t,s,i="unpaid"){const u={orderin_orderId:r,orderin_cart:JSON.stringify(t),orderin_billing:JSON.stringify(s),orderin_paymentStatus:i};Object.entries(u).forEach(([c,v])=>{localStorage.setItem(c,v)}),console.log("Order temp state saved to localStorage:",u)},load(){const r=localStorage.getItem("orderin_orderId"),t=localStorage.getItem("orderin_cart"),s=localStorage.getItem("orderin_billing"),i=localStorage.getItem("orderin_paymentStatus");if(!r||!t||!s)return null;try{return{orderin_orderId:r,orderin_cart:JSON.parse(t),orderin_billing:JSON.parse(s),orderin_paymentStatus:i||"unpaid"}}catch(u){return console.error("Error parsing temp order state:",u),null}},clear(){["orderin_orderId","orderin_cart","orderin_billing","orderin_paymentStatus","orderin_countercode_orderId","orderin_countercode_paymentMethod"].forEach(t=>localStorage.removeItem(t)),console.log("Order temp state cleared from localStorage")}};try{Object.freeze(Ne)}catch{}function At(...r){return Ne.save(...r)}function Be(){return Ne.load()}function ze(){return Ne.clear()}const Tt=r=>{try{localStorage.setItem("cart_items",JSON.stringify(r)),console.log("Cart persisted to localStorage:",r.length,"items")}catch(t){console.error("Error saving cart to localStorage:",t)}},Et=()=>{try{const r=localStorage.getItem("cart_items");if(r){const s=(JSON.parse(r)||[]).map(i=>Qe(i));return console.log("Cart restored from localStorage:",s.length,"items (normalized)"),s}}catch(r){console.error("Error loading cart from localStorage:",r)}return null},be=re("No Image"),Qe=r=>{if(!r)return r;try{if(r.image&&String(r.image).trim()!=="")return r;const t=typeof window<"u"&&window.__menu_products__?window.__menu_products__:null;let s="";if(t&&Array.isArray(t)){const i=t.find(u=>String(u.name||"").toLowerCase()===String(r.name||"").toLowerCase());i&&(s=i.image||i.imageUrl||i.imageURL||i.image_url||i.img||"")}return{...r,image:s||r.image||be}}catch{return{...r,image:r.image||be}}},xe=r=>String(r||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(),Lt=r=>{try{const t=typeof window<"u"&&window.__menu_products__?window.__menu_products__:null;if(!t||!r)return null;const s=xe(r);let i=t.find(C=>xe(C.name)===s);if(i||(i=t.find(C=>xe(C.name).includes(s)||s.includes(xe(C.name))),i))return i;const u=s.split(" ").filter(Boolean);let c=null,v=0;for(const C of t){const A=xe(C.name).split(" ").filter(Boolean),E=u.filter(U=>A.includes(U)).length;E>v&&(v=E,c=C)}if(v>0)return c}catch{return null}return null},We=r=>{try{return(typeof window<"u"&&window.__menu_products__?window.__menu_products__:null)?(r||[]).map(s=>{const i=Lt(s.name||s.productName||s.itemName||"");if(i){const u=i.image||i.imageUrl||i.imageURL||i.image_url||i.img||s.image||be;return{...i,quantity:s.quantity||1,instructions:s.instructions||"",image:u||be}}return{...s,image:s.image||be}}):r}catch{return r}},Rt=()=>{try{localStorage.removeItem("cart_items"),console.log("Cart cleared from localStorage")}catch(r){console.error("Error clearing cart from localStorage:",r)}},Dt=({children:r,tableNo:t="1"})=>{const[s,i]=l.useState(()=>Et()||[]),[u,c]=l.useState([]),[v,C]=l.useState(()=>{const S=new URLSearchParams(window.location.search).get("table");return S?(localStorage.setItem("tableNumber",S),S):localStorage.getItem("tableNumber")||t});l.useEffect(()=>{const m=localStorage.getItem("orderHistory");m&&c(JSON.parse(m))},[]),l.useEffect(()=>{Tt(s)},[s]),l.useEffect(()=>{let m=!1;const S=async()=>{try{const h=s.filter(y=>y&&y.image&&String(y.image).startsWith("gs://"));if(!h.length)return;await Promise.all(h.map(async y=>{try{const w=await de(y.image);if(m)return;w&&i(L=>L.map(D=>D.name===y.name?{...D,image:w}:D))}catch{}}))}catch{}};return s&&s.length&&S(),()=>{m=!0}},[s]),l.useEffect(()=>{const m=Be();if(m){console.log("Restoring temp order state from localStorage:",m);const S=(m.orderin_cart||[]).map(y=>Qe(y)),h=typeof window<"u"&&window.__menu_products__?We(S):S;i(h)}},[]),l.useEffect(()=>{const m=S=>{try{i(h=>We(h)),console.log("CartContext: updated cart items with loaded menu")}catch(h){console.error("Error updating cart items after menu load",h)}};return typeof window<"u"&&(window.addEventListener("menu:loaded",m),window.__menu_products__&&m()),()=>{typeof window<"u"&&window.removeEventListener("menu:loaded",m)}},[]),l.useEffect(()=>{localStorage.setItem("orderHistory",JSON.stringify(u))},[u]);const A=(m,S,h)=>{const y=s.find(w=>w.name===m.name);i(y?s.map(w=>w.name===m.name?{...w,quantity:w.quantity+S,instructions:h||w.instructions}:w):w=>[...w,{...m,quantity:S,instructions:h||""}]),(async()=>{try{const w=m.image||m.imageURL||m.image_url||"";if(w&&String(w).startsWith("gs://")){const L=await de(w);L&&i(D=>D.map(d=>d.name===m.name?{...d,image:L}:d))}}catch{}})()},E=(m,S)=>{i(s.map(h=>h.name===m?{...h,quantity:Math.max(1,S)}:h))},U=(m,S)=>{i(s.map(h=>h.name===m?{...h,instructions:S}:h))},J=m=>{i(s.filter(S=>S.name!==m))},M=()=>s.reduce((m,S)=>{const h=parseFloat(String(S.price||"").replace(/[^0-9.\-]/g,""))||0;return m+h*S.quantity},0).toFixed(2),P=()=>{i([]),Rt()},I=m=>{const S=s.reduce((D,d)=>{const p=parseFloat(String(d.price||"").replace(/[^0-9.\-]/g,""))||0;return D+p*d.quantity},0),y=S*.04,w=S+y,L={id:Date.now(),items:s,subtotal:S.toFixed(2),taxes:Number(y).toFixed(2),total:Number(w).toFixed(2),paymentMethod:m,status:"Pending",tableNo:v,time:new Date().toLocaleString(),timestamp:new Date};return c(D=>[...D,L]),L},k=m=>{c(h=>h.map(y=>y.id===m?{...y,status:"Paid"}:y)),P(),ze(),(async()=>{try{const h=JSON.parse(localStorage.getItem("user"));if(!h||!h.phone)return;const y=h.phone,w=te(Z,"Restaurant","orderin_restaurant_1","customers",y),L=await ae(w);if(!L.exists())return;const D=L.data(),p=(Array.isArray(D.pastOrders)?D.pastOrders:[]).map(W=>W.id===m?{...W,paymentStatus:"paid"}:W);await ce(w,{pastOrders:p},{merge:!0}),console.log("Order marked as paid in Firestore:",m)}catch(h){console.error("Error updating payment status in Firestore:",h)}})()};return e.jsx(Ye.Provider,{value:{cartItems:s,addToCart:A,updateQuantity:E,updateInstructions:U,removeFromCart:J,getTotalPrice:M,clearCart:P,placeOrder:I,markPaymentSuccessful:k,orderHistory:u,currentTableNo:v,saveOrderTempState:At,loadOrderTempState:Be,clearOrderTempState:ze},children:r})};function Ft(){const[r,t]=l.useState(!1),s=l.useRef(null),{currentTableNo:i}=ge(),u=()=>{t(!r)},c=ie(),{getPathWithTable:v}=ue();return l.useEffect(()=>{const C=A=>{s.current&&!s.current.contains(A.target)&&t(!1)};return r&&document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[r]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-bar",children:[e.jsx("img",{src:"/OrderIn.png",alt:"OrderIn",className:"orderin-logo-header"}),e.jsxs("div",{className:"table-number",children:["Table ",i]}),e.jsx("svg",{className:"menu-icon",onClick:u,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),e.jsx("div",{ref:s,className:`side-menu ${r?"open":""}`,children:e.jsxs("div",{className:"side-menu-content",children:[e.jsx("div",{className:"menu-item",onClick:()=>{c(v("/about-orderin")),t(!1)},children:"About OrderIn"}),e.jsx("div",{className:"menu-item",onClick:()=>{c(v("/about")),t(!1)},children:"About Restaurant"}),e.jsx("div",{className:"menu-item",onClick:()=>{c(v("/help")),t(!1)},children:"Help"})]})})]})}function Ie({onCartClick:r,onHomeClick:t,onProfileClick:s}){const i=ve();return ue(),e.jsxs("div",{className:"footer-bar",children:[e.jsxs("div",{className:`icon-container ${i.pathname==="/menu"?"active":""}`,onClick:t,children:[e.jsx(et,{className:"footer-icon"}),e.jsx("span",{children:"Home"})]}),e.jsxs("div",{className:`icon-container ${i.pathname==="/cart"?"active":""}`,onClick:r,children:[e.jsx(_e,{className:"footer-icon"}),e.jsx("span",{children:"Cart"})]}),e.jsxs("div",{className:`icon-container ${i.pathname==="/profile"?"active":""}`,onClick:s,children:[e.jsx(tt,{className:"footer-icon"}),e.jsx("span",{children:"Profile"})]})]})}var Mt={};const ee=(()=>{let r=[],t=[];const c=Object.freeze({get:()=>r,set:v=>{r=v,t.forEach(C=>{try{C(v)}catch{}})},subscribe:v=>(t.push(v),()=>{t=t.filter(C=>C!==v)})});return typeof window<"u"&&typeof process<"u"&&process,c})(),$e=(r,t)=>{const s=new Promise((i,u)=>setTimeout(()=>u(new Error("timeout")),t));return Promise.race([r,s])},Ut=async()=>{try{const t=(await Le(Re(Z,"Restaurant","orderin_restaurant_1","promotions"))).docs.map(i=>({id:i.id,...i.data()})),s=Date.now();return t.filter(i=>i.expiryAt?(typeof i.expiryAt=="object"&&i.expiryAt.toMillis?i.expiryAt.toMillis():i.expiryAt)>=s:!1)}catch(r){return console.warn("loadActivePromotions",r),[]}},Bt=(r,t=2,s=3e3)=>new Promise(i=>{if(!r)return i(!1);let u=0;const c=()=>{u+=1;const v=new Image;let C=!1;const A=setTimeout(()=>{C||(C=!0,v.onload=v.onerror=null,u<t?setTimeout(c,200):i(!1))},s);v.onload=()=>{C||(C=!0,clearTimeout(A),v.onload=v.onerror=null,i(!0))},v.onerror=()=>{C||(C=!0,clearTimeout(A),v.onload=v.onerror=null,u<t?setTimeout(c,200):i(!1))},v.src=r};c()});function zt({setIsLoading:r}){const{getPathWithTable:t}=ue(),s=ie(),[i,u]=l.useState(""),[c,v]=l.useState("Category"),[C,A]=l.useState(!1),[E,U]=l.useState("all"),[J,M]=l.useState(!1),[P,I]=l.useState(null),[k,m]=l.useState(!1),[S,h]=l.useState(""),y=l.useRef(null),[w,L]=l.useState([]),D=l.useRef(null);l.useEffect(()=>{let n=!0;return(async()=>{try{r(!0);const x=(await $e(Le(Re(Z,"Restaurant","orderin_restaurant_1","menu")),8e3)).docs.map(b=>({id:b.id,...b.data()}));if(!n)return;L(x),ee.set(x);try{window.__menu_products__=x,window.dispatchEvent(new CustomEvent("menu:loaded",{detail:x}))}catch{}r(!1);try{const b={total:x.length,missing:0,gs:0,http:0,relative:0,other:0},z=[];x.forEach(V=>{const G=(V.image||V.imageURL||V.imageUrl||V.image_url||V.img||"").toString();if(!G){b.missing+=1,z.length<5&&z.push({id:V.id,name:V.name,image:G});return}G.startsWith("gs://")?b.gs+=1:G.startsWith("http://")||G.startsWith("https://")?b.http+=1:G.indexOf("/")!==-1?b.relative+=1:b.other+=1,z.length<5&&!G.startsWith("http")&&!G.startsWith("gs://")&&z.push({id:V.id,name:V.name,image:G})}),console.info("Menu image diagnostics",b,z)}catch{}(async()=>{try{const b=await $e(Ut(),5e3);if(!b||b.length===0)return;try{const K={total:b.length,missing:0,gs:0,http:0,relative:0,other:0},se=[];b.forEach(Q=>{const oe=(Q.image||Q.imageURL||Q.imageUrl||Q.image_url||"").toString();if(!oe){K.missing+=1,se.length<5&&se.push({id:Q.id,caption:Q.caption,image:oe});return}oe.startsWith("gs://")?K.gs+=1:oe.startsWith("http://")||oe.startsWith("https://")?K.http+=1:oe.indexOf("/")!==-1?K.relative+=1:K.other+=1,se.length<5&&!oe.startsWith("http")&&!oe.startsWith("gs://")&&se.push({id:Q.id,caption:Q.caption,image:oe})}),console.info("Promotions image diagnostics",K,se)}catch{}const z="promotionsSeen",V=JSON.parse(localStorage.getItem(z)||"[]"),G=b.filter(K=>!V.includes(K.id)),H=G.length===0?b[Math.floor(Math.random()*b.length)]:G[Math.floor(Math.random()*G.length)];if(!H)return;const X={...H,imageURL:H.imageURL||H.imageUrl||H.image||H.image_url||""};I(X),m(!1),M(!0);try{V.push(H.id),localStorage.setItem(z,JSON.stringify(V))}catch{}let Y=X.imageURL;try{const K=await de(X.imageURL);K&&(Y=K)}catch{}if(h(Y),!await Bt(Y,2,2500))try{const K=await fetch(Y,{cache:"no-store"});if(K.ok){const se=K.headers&&K.headers.get?K.headers.get("content-type"):null;if(!se||!se.startsWith("image/"))console.warn("Promotion fetch returned non-image content-type, skipping blob fallback",Y,K.status,se),h(re("Promotion")),m(!0);else{const Q=await K.blob();y.current&&(URL.revokeObjectURL(y.current),y.current=null);const oe=URL.createObjectURL(Q);y.current=oe,h(oe)}}}catch(K){console.warn("Promotion blob fallback failed",Y,K);try{h(re("Promotion")),m(!0)}catch{}}}catch{}})()}catch(g){console.warn("fetchMenu error",g),r(!1)}})(),()=>{n=!1,y.current&&(URL.revokeObjectURL(y.current),y.current=null)}},[r]);const d=n=>u(n.target.value),p=n=>{v(n==="all"?"Category":n),A(!1)},W=()=>A(!C),F=n=>U(n),$=n=>s(`/item/${String(n.name||"").replace(/\s+/g,"-").toLowerCase()}${window.location.search}`,{state:{item:n}}),R=()=>{M(!1),y.current&&(URL.revokeObjectURL(y.current),y.current=null)},f=()=>m(!0);l.useEffect(()=>{const n=o=>{D.current&&!D.current.contains(o.target)&&A(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const O=n=>(n||"").toString().toLowerCase().replace(/[^a-z0-9]/g,""),T=n=>n?n.includes("nonveg")||n.includes("nonveget"):!1,B=n=>!n||T(n)?!1:n.includes("veg")||n.includes("veget"),q=n=>{if(n==null)return!1;try{const g=String(n).toLowerCase().trim().replace(/[^a-z0-9]/g,"");return new Set(["no","low","soldout","unavailable","outofstock","false","0","sold"]).has(g)}catch{return!1}},_=n=>{if(!n)return!1;const o=["promotions","promotion","onPromotion","promo","promotionStatus","promotion_flag"];for(const g of o){const x=n[g];if(x!=null){if(typeof x=="boolean")return x;if(typeof x=="number")return x!==0;if(typeof x=="string"){const b=x.toLowerCase().trim();if(["true","1","yes","on"].includes(b))return!0}}}return!1},a=n=>{const o=String(n||"");return{value:parseFloat(o.replace(/[^0-9.\-]/g,""))||0,symbol:"₹"}},N=qe.useMemo(()=>{const n=new Set,o=["all"];return w.forEach(g=>{if(g.category){const x=g.category.toLowerCase();n.has(x)||(n.add(x),o.push(g.category))}}),o},[w]),j=w.filter(n=>{const o=(n.name||"").toLowerCase(),g=(i||"").toLowerCase(),x=O(i),b=O(n.type||n.tags||""),z=T(x),V=!z&&B(x),G=T(b),H=B(b),X=o.includes(g)||g==="",Y=E==="all"||E==="veg"&&H||E==="nonveg"&&G,ne=X||z&&G||V&&H,K=c==="Category"||n.category&&n.category.toLowerCase()===(c||"").toLowerCase();return ne&&Y&&K});return e.jsxs("div",{className:"menu-container",children:[e.jsx(Ft,{}),J&&P&&e.jsx("div",{className:"ad-overlay visible",children:e.jsxs("div",{className:"ad-popup",children:[e.jsx("button",{className:"ad-close-btn",onClick:R,children:e.jsx(Ae,{size:20})}),e.jsxs("div",{className:"ad-content",children:[!k&&e.jsx("div",{className:"ad-image-spinner loading-spinner","aria-hidden":"true"}),e.jsx("img",{src:S||P.imageURL,alt:(P==null?void 0:P.caption)||"Promotion",className:"ad-image",style:{display:k?"block":"none"},onLoad:f,onError:n=>{console.warn("Image load failed",n.target.src,"promotion",P&&(P.id||P.caption)),(async()=>{try{const o=P&&(P.imageURL||P.imageUrl||P.image);if(String(n.target.src||"").startsWith("blob:")&&o)try{const g=await fetch(o,{method:"GET",cache:"no-store"});console.warn("Promotion probe result",o,"status",g.status,"content-type",g.headers&&g.headers.get?g.headers.get("content-type"):null)}catch(g){console.warn("Promotion probe failed",o,g)}}catch{}})();try{y.current&&String(n.target.src||"").startsWith("blob:")&&(URL.revokeObjectURL(y.current),y.current=null)}catch{}n.target.src=re("Promotion"),m(!0)}}),e.jsx("h2",{className:"ad-caption",children:P==null?void 0:P.caption}),e.jsx("p",{className:"ad-description",children:P==null?void 0:P.description})]})]})}),e.jsxs("div",{className:"search-bar-container",children:[e.jsxs("div",{className:"search-bar",children:[e.jsx(rt,{className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search menu items...",className:"search-input",value:i,onChange:d})]}),e.jsxs("div",{className:"filters-container",children:[e.jsxs("div",{className:"category-dropdown",ref:D,children:[e.jsxs("button",{className:"category-button",onClick:W,children:[c," ",e.jsx(Pe,{size:16})]}),C&&e.jsx("div",{className:"dropdown-menu",children:N.map(n=>e.jsx("div",{className:"dropdown-item",onClick:()=>p(n),children:n==="all"?"All":n.charAt(0).toUpperCase()+n.slice(1)},n))})]}),e.jsxs("div",{className:`veg-toggle ${E}`,children:[e.jsx("button",{className:"toggle-button","aria-label":"Veg",title:"Veg",onClick:()=>F("veg")}),e.jsx("button",{className:"toggle-button","aria-label":"All",title:"All",onClick:()=>F("all")}),e.jsx("button",{className:"toggle-button","aria-label":"Non-Veg",title:"Non-Veg",onClick:()=>F("nonveg")})]})]})]}),e.jsx("div",{className:"app-container",children:j.length>0?j.map((n,o)=>{const g=q(n.availability||n.status||n.availabilty);return e.jsxs("div",{className:`card ${g?"unavailable":""}`,onClick:()=>{if(g){console.debug("Navigation blocked: item unavailable",n&&(n.id||n.name));return}$(n)},role:"button","aria-disabled":g,tabIndex:g?-1:0,children:[e.jsx("img",{loading:"lazy",src:n.image||n.imageURL||n.image_url||re("No Image"),alt:n.name,className:"card-img",onError:x=>{console.warn("Image load failed",x.target.src,"item",n&&(n.id||n.name)),x.target.src=re("No Image")}}),e.jsxs("div",{className:"card-body",children:[e.jsx("h3",{className:"card-title",children:n.name}),e.jsx("p",{className:"card-price",children:_(n)?(()=>{const{value:x,symbol:b}=a(n.price),z=(x*1.25).toFixed(2);return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"price-normal",children:[b,Number(x).toFixed(2)]}),e.jsxs("span",{className:"price-increased",children:[b,Number(z).toFixed(2)]})]})})():e.jsxs("span",{className:"price-normal",children:[a(n.price).symbol,a(n.price).value.toFixed(2)]})})]})]},n.id||o)}):e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"No items found matching your search."})})}),e.jsx(Ie,{onCartClick:()=>s(t("/cart")),onHomeClick:()=>s(t("/menu")),onProfileClick:()=>s(t("/profile"))})]})}function Wt({setIsLoading:r}){const t=ie(),{getPathWithTable:s}=ue(),[i,u]=l.useState(""),[c,v]=l.useState(""),[C,A]=l.useState(""),[E,U]=l.useState("about"),J=ve();l.useEffect(()=>{try{const k=new URLSearchParams(J.search).get("section");k&&U(k)}catch{}},[J.search]);const M=I=>{if(I.preventDefault(),!c){alert("Please enter your email before sending.");return}const k="purnvasu.vap@gmail.com",m=encodeURIComponent("OrderIn Help Request"),S=[];i&&S.push(`Name: ${i}`),S.push(`From: ${c}`),S.push(""),S.push("Message:"),S.push(C||"(no message provided)");const h=encodeURIComponent(S.join(`
`));window.location.href=`mailto:${k}?subject=${m}&body=${h}`},P=I=>U(E===I?null:I);return e.jsx("div",{className:"help-container",children:e.jsxs("div",{className:"help-card",children:[e.jsxs("div",{className:"help-header-row",children:[e.jsx("button",{className:"help-back",onClick:()=>t(s("/menu")),children:"Back"}),e.jsx("h1",{children:"Help & FAQ"})]}),e.jsxs("div",{className:"help-accordion",children:[e.jsxs("div",{className:"accordion-item",children:[e.jsx("button",{className:"accordion-caption","aria-expanded":E==="about",onClick:()=>P("about"),children:"About this project"}),E==="about"&&e.jsx("div",{className:"accordion-content",children:e.jsx("p",{children:"This is the OrderIn demo app — a simple restaurant ordering front-end backed by Firestore. Use the menu to add items to your cart, proceed to payment, and get a receipt."})})]}),e.jsxs("div",{className:"accordion-item",children:[e.jsx("button",{className:"accordion-caption","aria-expanded":E==="faq",onClick:()=>P("faq"),children:"Quick FAQs"}),E==="faq"&&e.jsx("div",{className:"accordion-content",children:e.jsxs("dl",{children:[e.jsx("dt",{children:"How does OTP (verification code) work?"}),e.jsx("dd",{children:"We collect a verification code (OTP) to verify your phone number. Enter the 4-6 digit code sent to your phone in the login flow — the app stores it briefly to complete authentication."}),e.jsx("dt",{children:"Why is the price shown with ₹125 when item is ₹100?"}),e.jsx("dd",{children:"Items marked with promotions will show an increased display price of +25% (visual only) next to the normal menu price. The original price remains the primary price displayed."}),e.jsx("dt",{children:"What if an item shows unavailable?"}),e.jsx("dd",{children:"Items marked unavailable are dimmed and non-interactive; you can still view them but cannot add them to cart."})]})})]}),e.jsxs("div",{className:"accordion-item",children:[e.jsx("button",{className:"accordion-caption","aria-expanded":E==="contact",onClick:()=>P("contact"),children:"Contact Help"}),E==="contact"&&e.jsxs("div",{className:"accordion-content",children:[e.jsxs("p",{children:["If you need additional assistance, send us a message. Enter your email and message below, then click",e.jsx("strong",{children:" Send "})," — your email client will open with the message prefilled and addressed to our support."]}),e.jsxs("form",{className:"help-form",onSubmit:M,children:[e.jsxs("label",{children:["Name (optional)",e.jsx("input",{value:i,onChange:I=>u(I.target.value),placeholder:"Your name"})]}),e.jsxs("label",{children:["Your Email (required)",e.jsx("input",{value:c,onChange:I=>v(I.target.value),placeholder:"you@domain.com",required:!0})]}),e.jsxs("label",{children:["Message",e.jsx("textarea",{value:C,onChange:I=>A(I.target.value),placeholder:"How can we help?"})]}),e.jsxs("div",{className:"help-actions",children:[e.jsx("button",{type:"submit",className:"send-btn",children:"Send"}),e.jsx("button",{type:"button",className:"back-btn",onClick:()=>t(s("/menu")),children:"Back to Menu"})]})]})]})]})]})]})})}function $t(){const r=ie(),{getPathWithTable:t}=ue();return e.jsxs("div",{className:"about-root",children:[e.jsx("div",{className:"about-topbar",children:e.jsx("button",{className:"btn-top-back","aria-label":"Back to Menu",onClick:()=>r(t("/menu")),children:"← Back to Menu"})}),e.jsx("div",{className:"parallax-section hero",children:e.jsxs("div",{children:[e.jsx("h1",{children:"Welcome to Foodie's Paradise"}),e.jsx("p",{children:"Fresh Ingredients, Delicious Recipes, Delivered to Your Doorstep"})]})}),e.jsxs("div",{className:"menu-section",children:[e.jsx("h2",{children:"Our Restaurant"}),e.jsxs("div",{className:"branch-list",children:[e.jsxs("div",{className:"branch-card",children:[e.jsx("img",{src:"https://picsum.photos/400/260?restaurant,1",alt:"Branch 1"}),e.jsxs("div",{className:"branch-content",children:[e.jsx("h3",{children:"Central Branch"}),e.jsx("p",{children:"123 Main Street, City Center"}),e.jsx("p",{children:"Open: 9:00 AM - 11:00 PM"}),e.jsx("p",{children:"Phone: +91 98765 43210"})]})]}),e.jsxs("div",{className:"branch-card",children:[e.jsx("img",{src:"https://picsum.photos/400/260?restaurant,2",alt:"Branch 2"}),e.jsxs("div",{className:"branch-content",children:[e.jsx("h3",{children:"Riverside Branch"}),e.jsx("p",{children:"45 Riverside Drive, Northside"}),e.jsx("p",{children:"Open: 10:00 AM - 10:00 PM"}),e.jsx("p",{children:"Phone: +91 91234 56789"})]})]}),e.jsxs("div",{className:"branch-card",children:[e.jsx("img",{src:"https://picsum.photos/400/260?restaurant,3",alt:"Branch 3"}),e.jsxs("div",{className:"branch-content",children:[e.jsx("h3",{children:"Mall Outlet"}),e.jsx("p",{children:"Unit G12, City Mall"}),e.jsx("p",{children:"Open: 11:00 AM - 10:30 PM"}),e.jsx("p",{children:"Phone: +91 90123 45678"})]})]})]})]}),e.jsx("div",{className:"rotating-plate","aria-hidden":"true"}),e.jsx("div",{className:"parallax-section specials-section",children:e.jsxs("div",{className:"employees-overlay",children:[e.jsxs("div",{className:"employees-header",children:[e.jsx("h2",{children:"Our Employees"}),e.jsx("p",{children:"Meet the team behind Foodie's Paradise"})]}),e.jsx("div",{className:"employees-grid overlay-grid",children:[{name:"Rajesh Kumar",role:"Head Chef",img:"https://picsum.photos/260/260?chef1"},{name:"Meera Patel",role:"Sous Chef",img:"https://picsum.photos/260/260?chef2"},{name:"Arjun Singh",role:"Pastry Chef",img:"https://picsum.photos/260/260?chef3"},{name:"Priya Sharma",role:"Restaurant Manager",img:"https://picsum.photos/260/260?manager"},{name:"Vikram Das",role:"Accountant",img:"https://picsum.photos/260/260?accountant"},{name:"Anita Rao",role:"Front of House",img:"https://picsum.photos/260/260?staff"}].map(s=>e.jsxs("div",{className:"employee-card",children:[e.jsx("div",{className:"employee-image",children:e.jsx("img",{src:s.img,alt:s.name})}),e.jsxs("div",{className:"employee-info",children:[e.jsx("h4",{children:s.name}),e.jsx("p",{className:"role",children:s.role})]})]},s.name))})]})}),e.jsxs("div",{className:"about-section",children:[e.jsx("h2",{children:"About Us"}),e.jsx("p",{children:"At Foodie's Paradise, we believe in delivering the freshest and most delicious meals to your doorstep. Our team is passionate about quality, sustainability, and customer satisfaction."}),e.jsx("div",{className:"about-actions",children:e.jsx("button",{onClick:()=>r(t("/menu")),className:"btn-primary",children:"Back to Menu"})})]}),e.jsx("div",{className:"footer",children:e.jsx("p",{children:"© 2025 Foodie's Paradise. All Rights Reserved."})})]})}function qt(){const r=ie(),{getPathWithTable:t}=ue(),s=[{title:"Bill Generation",description:"Automated bill creation for seamless transactions.",image:"/bill-generation.jpeg"},{title:"Work Finance Handling",description:"Efficient tracking and management of finances.",image:"/work-finance.jpeg"},{title:"Inventory Support",description:"Advanced inventory tracking with real-time updates.",image:"/inventory-support.jpeg"},{title:"Links Inventory Flash Checking",description:"Quick and accurate inventory flash checks.",image:"/inventory-flash.jpeg"},{title:"Order Receiving",description:"Track and manage all incoming orders effortlessly.",image:"/order-receiving.jpeg"},{title:"Dynamic Menu Controlling",description:"Instant menu item updates based on business needs.",image:"/dynamic-menu.jpeg"},{title:"Advertising",description:"Built-in tools to publish and manage advertisements.",image:"/advertising.jpeg"},{title:"Feedback Receiving",description:"Collect and analyze customer feedback.",image:"/feedback.jpeg"}];return e.jsxs("div",{className:"orderin-about-container",children:[e.jsx("div",{className:"back-button-container",children:e.jsx("button",{className:"back-button-top",onClick:()=>r(t("/menu")),"aria-label":"Back to Menu",children:"← Back to Home"})}),e.jsxs("header",{className:"orderin-header",children:[e.jsx("img",{src:"/OrderIn.png",alt:"OrderIn Logo",className:"logo"}),e.jsx("p",{className:"by-text",children:"By"}),e.jsx("img",{src:"/company-logo.png",alt:"Company Logo",className:"Clogo"})]}),e.jsxs("main",{className:"orderin-main",children:[e.jsxs("section",{className:"orderin-section animated-section animated-section-delay-1",children:[e.jsxs("div",{className:"about-header",children:[e.jsx("h2",{children:"About"}),e.jsx("img",{src:"/OrderIn.png",alt:"OrderIn Logo",className:"logo2"})]}),e.jsx("p",{children:"OrderIn is a comprehensive ordering support and CRM platform designed to streamline business operations."})]}),e.jsxs("section",{className:"orderin-section animated-section animated-section-delay-2",children:[e.jsx("h2",{children:"Our Services"}),e.jsx("div",{className:"services-grid",children:s.map((i,u)=>e.jsxs("div",{className:"service-card with-image",children:[e.jsx("img",{src:i.image,alt:i.title,className:"service-img"}),e.jsxs("div",{className:"service-content",children:[e.jsx("h3",{children:i.title}),e.jsx("p",{children:i.description})]})]},u))})]}),e.jsxs("section",{className:"orderin-section animated-section animated-section-delay-3",children:[e.jsx("h2",{children:"Contact Us"}),e.jsxs("p",{children:[e.jsx("span",{className:"contact-label",children:"Email:"}),e.jsx("a",{href:"mailto:purnvasu.vap@gmail.com",className:"contact-link",children:"purnvasu.vap@gmail.com"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"contact-label",children:"Phone:"}),e.jsx("a",{href:"tel:+918639987869",className:"contact-link",children:"+91 8639987869"})]})]}),e.jsxs("section",{className:"orderin-section animated-section animated-section-delay-3",children:[e.jsx("h2",{children:"Explore More"}),e.jsxs("div",{className:"explore-container",children:[e.jsx("a",{href:"https://purnvasu.in/",target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:"/company-logo.png",alt:"PurnVasu Tech Solutions",className:"Clogo2"})}),e.jsxs("p",{className:"explore-text",children:["Click here to explore ",e.jsx("br",{}),e.jsx("span",{className:"explore-subtext",children:"(Our amazing landing page)"})]})]})]})]}),e.jsx("footer",{className:"orderin-footer",children:e.jsx("p",{children:"© 2025 PurnVasu Tech Solutions Private Limited. All rights reserved."})})]})}function Ht(){var n;const r=ve(),t=ie(),{id:s}=at(),{addToCart:i}=ge(),{getPathWithTable:u}=ue(),[c,v]=l.useState(((n=r.state)==null?void 0:n.item)||null),[C,A]=l.useState(!c),[E,U]=l.useState(null),[J,M]=l.useState(1),[P,I]=l.useState(!1),[k,m]=l.useState(""),[S,h]=l.useState(!1),[y,w]=l.useState(null),[L,D]=l.useState(null),[d,p]=l.useState(!1),[W,F]=l.useState(c&&(c.image||c.imageURL||c.image_url)||"");l.useEffect(()=>{let o=!0;return(async()=>{try{const x=c&&(c.image||c.imageURL||c.image_url||"");if(!x){o&&F("");return}if(x.startsWith("gs://")){const b=await de(x);o&&F(b||x)}else o&&F(x)}catch{o&&F(c.image||c.image_url||"")}})(),()=>{o=!1}},[c]);const $=o=>String(o||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim();if(l.useEffect(()=>{let o=!0;return(async()=>{try{const x=localStorage.getItem("user");if(!x)return;const b=JSON.parse(x);if(!b||!b.phone)return;const z=te(Z,"Restaurant","orderin_restaurant_1","customers",b.phone),V=await ae(z);if(!o)return;if(!V.exists()){p(!1);return}const G=V.data(),X=(Array.isArray(G.likedItems)?G.likedItems:[]).find(Y=>Y.id&&c.id&&String(Y.id)===String(c.id)||$(Y.name)===$(c.name));p(!!X)}catch(x){console.error("Error initializing favorite state",x)}})(),()=>{o=!1}},[c]),l.useEffect(()=>{!c&&s&&(async()=>{try{const b=(await Le(Re(Z,"Restaurant","orderin_restaurant_1","menu"))).docs.map(z=>({id:z.id,...z.data()})).find(z=>z.name.replace(/\s+/g,"-").toLowerCase()===s);b?v(b):U("Item not found"),A(!1)}catch(g){U(g.message),A(!1)}})()},[c,s]),C)return e.jsx("div",{className:"itemdetails-loading",children:"Loading item details..."});if(E)return e.jsx("div",{className:"itemdetails-error",children:E});if(!c)return e.jsx("div",{className:"itemdetails-error",children:"No item data found."});const R=o=>{D(null),w(o.targetTouches[0].clientX)},f=o=>D(o.targetTouches[0].clientX),O=()=>{},T=()=>t(-1),B=o=>{M(g=>Math.max(1,g+o))},q=()=>{I(!0)},_=()=>{i(c,J,k),h(!0),I(!1)},a=()=>{I(!1)},N=async()=>{try{const o=localStorage.getItem("user");if(!o){alert("Please login to save favorites");return}const g=JSON.parse(o);if(!g||!g.phone){alert("Please login to save favorites");return}const x=te(Z,"Restaurant","orderin_restaurant_1","customers",g.phone),b=await ae(x),z=b.exists()?Array.isArray(b.data().likedItems)?b.data().likedItems:[]:[];if(d){const V=z.filter(G=>!(G.id&&c.id&&String(G.id)===String(c.id)||$(G.name)===$(c.name)));await ce(x,{likedItems:V},{merge:!0}),p(!1)}else{const G=[{id:c.id||c.productId||c.name,name:c.name,image:c.image||"",price:c.price||"",addedAt:new Date().toISOString()},...z.filter(Boolean)];await ce(x,{likedItems:G},{merge:!0}),p(!0)}}catch(o){console.error("Error toggling favorite",o)}},j=(parseFloat(String(c.price||"").replace(/[^0-9.\-]/g,""))*J).toFixed(2);return e.jsxs("div",{className:"itemdetails-overlay",onTouchStart:R,onTouchMove:f,onTouchEnd:O,children:[e.jsx("div",{className:"itemdetails-header",children:e.jsx("button",{className:"bac-button",onClick:T,children:e.jsx(nt,{size:22})})}),e.jsx("div",{className:"itemdetails-image-container",children:c.videos?e.jsx("video",{src:c.videos,poster:W||c.image||re("No Image"),autoPlay:!0,loop:!0,muted:!0,className:"itemdetails-image",onError:o=>{console.warn("Media poster failed",o.target.poster,"item",c&&(c.id||c.name)),o.target.poster=re("No Image")}}):e.jsx("img",{src:W||c.image||re("No Image"),alt:c.name,className:"itemdetails-image",onError:o=>{console.warn("Image load failed",o.target.src,"item",c&&(c.id||c.name)),o.target.src=re("No Image")}})}),e.jsxs("div",{className:"itemdetails-info",children:[e.jsxs("div",{className:"itemdetails-header-row",children:[e.jsx("h2",{className:"itemdetails-title",children:c.name}),e.jsx(st,{size:22,className:`heart-icon ${d?"favorited":""}`,onClick:N})]}),e.jsx("p",{className:"itemdetails-description",children:c.description}),e.jsxs("div",{className:"quantity-section",children:[e.jsx("button",{className:"qty-btn",onClick:()=>B(-1),children:e.jsx(Te,{size:18})}),e.jsx("span",{className:"qty-value",children:J}),e.jsx("button",{className:"qty-btn",onClick:()=>B(1),children:e.jsx(Ee,{size:18})})]}),e.jsxs("div",{className:"bottom-bar",children:[e.jsxs("div",{className:"price-section",children:[e.jsx("p",{className:"price-label",children:"Total Price"}),e.jsxs("p",{className:"price-value",children:["₹",j]})]}),e.jsx("button",{className:`add-to-cart-btn ${S?"added":""}`,onClick:q,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(ot,{size:18})," ✓ Added"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:18})," Add to Cart"]})})]}),P&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h3",{children:"Food Instructions"}),e.jsx("textarea",{placeholder:"Add any special instructions...",value:k,onChange:o=>m(o.target.value),rows:4}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{className:"cancel-btn",onClick:a,children:"Cancel"}),e.jsx("button",{className:"save-btn",onClick:_,children:"Save"})]})]})})]}),e.jsx(Ie,{onCartClick:()=>t(u("/cart")),onHomeClick:()=>t(u("/menu")),onProfileClick:()=>t(u("/profile"))})]})}function Jt({onBackClick:r,onCartClick:t}){const s=ie(),{getPathWithTable:i}=ue(),[u,c]=l.useState({username:"",phone:""}),[v,C]=l.useState([]),[A,E]=l.useState([]),[U,J]=l.useState(null),{addToCart:M}=ge(),P=re("No Image"),I=a=>`₹${(parseFloat(String(a||"").replace(/[^0-9.\-]/g,""))||0).toFixed(2)}`;l.useEffect(()=>{const a=localStorage.getItem("user");a&&c(JSON.parse(a)),(async()=>{try{const o=localStorage.getItem("user");if(!o)return;const g=JSON.parse(o);if(!g||!g.phone)return;const x=te(Z,"Restaurant","orderin_restaurant_1","customers",g.phone),b=await ae(x);if(!b.exists()){C([]);return}const z=b.data(),G=(Array.isArray(z.pastOrders)?z.pastOrders:[]).map((H,X)=>{const Y=Array.isArray(H.items)&&H.items.length>0?H.items[0]:{name:H.itemName||"Item",price:H.total||"₹0.00"},ne=ee&&ee.get().length>0?ee.get():typeof window<"u"?window.__menu_products__||[]:[],K=m(Y),se=!K&&ne.length>0,Q=K?{...K}:null,oe=Q?Q.image||Q.imageUrl||Q.imageURL||Q.image_url||Q.img||"":Y.image||Y.image_url||P,De=Q?Q.price||Y.price:Y.price||"₹0.00",Ce=Q?{...Q,image:oe||P,price:De}:{name:Y.name,image:oe||P,price:De,unavailable:se};Ce.paidPrice||(Ce.paidPrice=Y&&(Y.price||Y.paidPrice)||H.total||null);let ke=new Date().toISOString();if(H.createdAt)try{ke=typeof H.createdAt=="string"?H.createdAt:H.createdAt.toDate?H.createdAt.toDate().toISOString():new Date(H.createdAt).toISOString()}catch{ke=new Date().toISOString()}return{id:H.id||`order-${X}`,item:Ce,quantity:H.items&&H.items.length>0?H.items[0].quantity||1:H.quantity||1,instructions:H.items&&H.items.length>0&&H.items[0].instructions||H.instructions||"",rawItem:Y,timestamp:new Date(ke)}}).reverse();C(G)}catch(o){console.error("Profile: error fetching pastOrders",o)}})();let j=null;return(async()=>{try{const o=localStorage.getItem("user");if(!o)return;const g=JSON.parse(o);if(!g||!g.phone)return;const x=te(Z,"Restaurant","orderin_restaurant_1","customers",g.phone);j=Ve(x,b=>{if(!b.exists()){E([]);return}const z=b.data(),V=Array.isArray(z.likedItems)?z.likedItems:[],G=ee&&ee.get().length>0?ee.get():typeof window<"u"?window.__menu_products__||[]:[],H=V.map(X=>{const Y=m(X)||G.find(Q=>String(Q.id)===String(X.id)),ne=Y?{...Y}:null,K=ne?ne.image||ne.imageUrl||ne.imageURL||ne.image_url||ne.img||"":X.image||X.image_url||P,se=ne?ne.price||X.price:X.price||"₹0.00";return ne?{...ne,image:K||P,price:se,raw:X}:{name:X.name,id:X.id,image:K||P,price:se,raw:X}});E(H)},b=>{console.error("Profile likedItems snapshot error",b)})}catch(o){console.error("Profile: subscribeLiked error",o)}})(),()=>{typeof j=="function"&&j()}},[]),l.useEffect(()=>{const a=N=>{try{console.log("Profile: menu:loaded event received, remapping orderHistory"),C(j=>j.map(n=>{const o=n.rawItem||{name:n.item.name},g=m(o),x=ee&&ee.get().length>0?ee.get():typeof window<"u"?window.__menu_products__||[]:[],b=!g&&x.length>0,z=g?{...g}:null,V=z?z.image||z.imageUrl||z.imageURL||z.image_url||z.img||"":o.image||o.image_url||P,G=z?z.price||o.price:o.price||"₹0.00",H=z?{...z,image:V||P,price:G}:{name:o.name,image:V||P,price:G,unavailable:b};return H.paidPrice||(H.paidPrice=o&&(o.price||o.paidPrice)||n.item.paidPrice||null),{...n,item:H}}))}catch(j){console.error("Profile: error remapping orderHistory after menu load",j)}};return typeof window<"u"&&(window.addEventListener("menu:loaded",a),window.__menu_products__&&a()),()=>{typeof window<"u"&&window.removeEventListener("menu:loaded",a)}},[]),l.useEffect(()=>{const a=()=>{try{E(N=>N.map(j=>{const n=j.raw||{name:j.name},o=m(n),g=ee&&ee.get().length>0?ee.get():typeof window<"u"?window.__menu_products__||[]:[],x=!o&&g.length>0,b=o?{...o}:null,z=b?b.image||b.imageUrl||b.imageURL||b.image_url||b.img||"":n.image||n.image_url||P,V=b?b.price||n.price:n.price||"₹0.00";return b?{...b,image:z||P,price:V,raw:n}:{name:n.name,image:z||P,price:V,unavailable:x,raw:n}}))}catch(N){console.error("Profile: error remapping likedItems after menu load",N)}};return typeof window<"u"&&(window.addEventListener("menu:loaded",a),window.__menu_products__&&a()),()=>{typeof window<"u"&&window.removeEventListener("menu:loaded",a)}},[]),l.useEffect(()=>{let a=!1;const N=async()=>{try{const j=await Promise.all(v.map(async o=>{var x;const g=(x=o==null?void 0:o.item)==null?void 0:x.image;if(!g)return null;try{if(g.startsWith&&g.startsWith("gs://")){const b=await de(g);if(b)return{orderId:o.id,url:b};console.warn("Profile: resolveImageUrl returned no URL for orderHistory image",g,"orderId=",o.id)}if(!g.startsWith("http://")&&!g.startsWith("https://")&&!g.startsWith("data:")&&!g.startsWith("blob:")){const b=await de(g);if(b)return{orderId:o.id,url:b}}}catch(b){console.warn("Profile: error resolving orderHistory image",g,b)}return null}));if(a)return;const n=new Map(j.filter(Boolean).map(o=>[o.orderId,o.url]));if(n.size===0)return;C(o=>o.map(g=>({...g,item:{...g.item,image:n.get(g.id)||g.item.image}})))}catch{}};return v&&v.length&&N(),()=>{a=!0}},[v]),l.useEffect(()=>{let a=!1;const N=async()=>{try{const j=await Promise.all(A.map(async(o,g)=>{const x=o==null?void 0:o.image;if(!x)return null;try{if(x.startsWith&&x.startsWith("gs://")){const b=await de(x);if(b)return{idx:g,url:b};console.warn("Profile: resolveImageUrl returned no URL for liked item image",x,"idx=",g)}if(!x.startsWith("http://")&&!x.startsWith("https://")&&!x.startsWith("data:")&&!x.startsWith("blob:")){const b=await de(x);if(b)return{idx:g,url:b}}}catch(b){console.warn("Profile: error resolving liked item image",x,b)}return null}));if(a)return;const n=new Map(j.filter(Boolean).map(o=>[o.idx,o.url]));if(n.size===0)return;E(o=>o.map((g,x)=>({...g,image:n.get(x)||g.image})))}catch{}};return A&&A.length&&N(),()=>{a=!0}},[A]);const k=a=>String(a||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(),m=a=>{if(!a)return null;const N=k(a.name||a.itemName||""),j=a.id||a.productId||a.productID||a.sku||null,n=ee&&ee.get().length>0?ee.get():typeof window<"u"?window.__menu_products__||[]:[];if(j){const o=n.find(g=>String(g.id)===String(j)||String(g._id)===String(j)||String(g.productId)===String(j));if(o)return o}if(N){const o=n.find(V=>k(V.name)===N);if(o)return o;const g=n.find(V=>k(V.name).includes(N)||N.includes(k(V.name)));if(g)return g;const x=N.split(" ").filter(Boolean);let b=null,z=0;for(const V of n){const G=k(V.name).split(" ").filter(Boolean),H=x.filter(X=>G.includes(X)).length;H>z&&(z=H,b=V)}if(z>0)return b}return null},[S,h]=l.useState(!1),[y,w]=l.useState(null),[L,D]=l.useState(""),[d,p]=l.useState(""),[W,F]=l.useState(!1),[$,R]=l.useState(new Set),f=(a,N=1,j="")=>{const n=m(a)||(products||[]).find(x=>String(x.name||"").toLowerCase()===String(a.name||"").toLowerCase());if(!n){p(`${a.name} is no longer present`),F(!0),setTimeout(()=>F(!1),3e3);return}const o=n.image||n.imageUrl||n.imageURL||n.image_url||n.img||a.image||a.image_url||P,g={...n,image:o||P,price:n.price||a.price};M(g,N,j),R(x=>new Set([...x,a.name])),p(`${a.name} added to cart!`),F(!0),setTimeout(()=>{F(!1),R(x=>{const b=new Set(x);return b.delete(a.name),b})},3e3)},O=a=>{w(a),D(""),h(!0)},T=()=>{if(y){const a=ee&&ee.get().length>0?ee.get():typeof window<"u"?window.__menu_products__||[]:[],N=m(y)||a.find(n=>String(n.name||"").toLowerCase()===String(y.name||"").toLowerCase());if(!N){if(a.length===0){M({...y,image:y.image||P,price:y.price||y.paidPrice||"₹0.00"},1,L),p(`${y.name} added to cart (menu not loaded)`),F(!0),setTimeout(()=>F(!1),3e3),h(!1),w(null),D("");return}p(`${y.name} is no longer present`),F(!0),setTimeout(()=>F(!1),3e3);return}const j=N.image||N.imageUrl||N.imageURL||N.img||y.image||P;M({...N,image:j||P,price:N.price||y.price},1,L),p(`${y.name} added to cart!`),F(!0),setTimeout(()=>F(!1),3e3),h(!1),w(null),D("")}},B=()=>{h(!1),w(null),D("")},q=a=>{J(U===a?null:a)},_=a=>a.toLocaleDateString()+" at "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"profile-container",children:[e.jsxs("header",{className:"profile-header",children:[e.jsx("div",{className:"back-icon",onClick:()=>{r?r():s(-1)},children:e.jsx(He,{size:20})}),e.jsx("h1",{className:"profile-title",children:"Profile"})]}),e.jsxs("div",{className:"profile-content",children:[e.jsxs("div",{className:"user-info",children:[e.jsxs("div",{className:"user-detail",children:[e.jsx("label",{children:"Name:"}),e.jsx("span",{children:u.username})]}),e.jsxs("div",{className:"user-detail",children:[e.jsx("label",{children:"Phone:"}),e.jsx("span",{children:u.phone})]})]}),e.jsxs("div",{className:"profile-sections",children:[e.jsxs("div",{className:"profile-section order-history",children:[e.jsxs("div",{className:"section-header",onClick:()=>q("orders"),children:[e.jsx("h3",{children:"Order History"}),e.jsx(Pe,{size:20,className:`chevron ${U==="orders"?"expanded":""}`})]}),U==="orders"&&e.jsx("div",{className:"section-content",children:e.jsx("div",{className:"scrollable-content",children:v.length===0?e.jsx("p",{className:"empty-message",children:"No orders yet"}):v.map(a=>e.jsxs("div",{className:"order-item",children:[e.jsxs("div",{className:"order-info",children:[e.jsx("img",{src:a.item.image,alt:a.item.name,className:"order-image",onError:N=>{console.warn("Image load failed",N.currentTarget.src,"order",a&&(a.id||a.item&&(a.item.id||a.item.name))),N.currentTarget.src=re("No Image")}}),e.jsxs("div",{className:"order-details",children:[e.jsxs("div",{className:"order-title-zone",children:[e.jsx("h4",{className:"order-title",children:a.item.name}),a.item.category&&e.jsx("span",{className:"order-category",children:a.item.category}),e.jsx("div",{className:"order-timestamp",children:_(a.timestamp)})]}),e.jsxs("div",{className:"order-meta-zone",children:[e.jsxs("span",{className:"order-qty",children:[a.quantity," plates"]}),e.jsx("span",{className:"dot",children:"•"}),e.jsxs("span",{className:"order-paid",children:["Paid: ",I(a.item.paidPrice||a.item.price)]}),a.item.price&&a.item.price!==a.item.paidPrice&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"dot",children:"•"}),e.jsxs("span",{className:"order-menu-price",children:["Menu: ",I(a.item.price)]})]})]}),a.item.description&&e.jsx("p",{className:"order-desc-zone",children:a.item.description}),a.instructions&&e.jsxs("p",{className:"order-instructions-zone",children:[e.jsx("strong",{children:"Specifications:"})," ",a.instructions]}),a.item.unavailable&&e.jsx("p",{className:"order-unavailable",children:"This item is no longer available"})]})]}),e.jsx("button",{className:`add-btn ${$.has(a.item.name)?"added":""}`,onClick:()=>f(a.item,a.quantity,a.instructions),disabled:$.has(a.item.name)||a.item.unavailable,title:a.item.unavailable?"Unavailable":$.has(a.item.name)?"Added":"Add to Cart",children:e.jsx(_e,{size:20})})]},a.id))})})]}),e.jsxs("div",{className:"profile-section",children:[e.jsxs("div",{className:"section-header",onClick:()=>q("liked"),children:[e.jsx("h3",{children:"Liked List"}),e.jsx(Pe,{size:20,className:`chevron ${U==="liked"?"expanded":""}`})]}),U==="liked"&&e.jsx("div",{className:"section-content",children:A.length===0?e.jsx("p",{className:"empty-message",children:"No liked items yet"}):A.map(a=>e.jsxs("div",{className:"liked-item",children:[e.jsxs("div",{className:"liked-info",children:[e.jsx("img",{src:a.image,alt:a.name,className:"liked-image",onError:N=>{console.warn("Image load failed",N.currentTarget.src,"liked",a&&(a.id||a.name)),N.currentTarget.src=re("No Image")}}),e.jsxs("div",{className:"liked-details",children:[e.jsx("h4",{children:a.name}),e.jsx("p",{className:"liked-price",children:I(a.price)})]})]}),e.jsx("button",{className:"add-btn",onClick:()=>O(a),title:"Add to Cart",children:e.jsx(_e,{size:20})})]},a.name))})]})]})]}),S&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h3",{children:"Food Instructions"}),e.jsx("textarea",{placeholder:"Add any special instructions...",value:L,onChange:a=>D(a.target.value),rows:4}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{className:"cancel-btn",onClick:B,children:"Cancel"}),e.jsx("button",{className:"save-btn",onClick:T,children:"Save"})]})]})}),W&&e.jsx("div",{className:"toast",children:d}),e.jsx(Ie,{onCartClick:()=>s(i("/cart")),onHomeClick:()=>s(i("/menu")),onProfileClick:()=>s(i("/profile"))})]})}function Vt({onBackClick:r}){const[t,s]=l.useState("Current Order"),{cartItems:i,updateQuantity:u,updateInstructions:c,removeFromCart:v,getTotalPrice:C}=ge(),[A,E]=l.useState([]),U=l.useRef({});l.useEffect(()=>{let p=null;const W=localStorage.getItem("user");if(!W)return;const F=JSON.parse(W);if(!F||!F.phone)return;const $=te(Z,"Restaurant","orderin_restaurant_1","customers",F.phone);return p=Ve($,R=>{if(!R.exists()){E([]);return}const f=R.data(),O=Array.isArray(f.pastOrders)?f.pastOrders:[],T=Date.now(),B=O.map((q,_)=>{let a=(q.status||"Pending").toLowerCase(),N="Pending";a==="preparing"?N="Preparing":a==="ready"?N="Ready":a==="delivered"?N="Delivered":a==="paid"&&(N="Paid");let j=q.createdAt;if(j&&j.toDate?j=j.toDate():typeof j=="string"?j=new Date(j):j=new Date,N==="Delivered"){const n=q.deliveredAt&&q.deliveredAt.toDate?q.deliveredAt.toDate():q.deliveredAt?new Date(q.deliveredAt):j,o=T-n.getTime();return o<300*1e3?(U.current[q.id||_]||(U.current[q.id||_]=setTimeout(()=>{E(g=>g.filter(x=>(x.id||x._idx)!==(q.id||_))),delete U.current[q.id||_]},Math.max(120*1e3,300*1e3-o))),{...q,id:q.id||_,status:N,timestamp:j,_idx:_}):null}return{...q,id:q.id||_,status:N,timestamp:j,_idx:_}}).filter(Boolean);B.sort((q,_)=>_.timestamp-q.timestamp),E(B)}),()=>{p&&p(),Object.values(U.current).forEach(clearTimeout),U.current={}}},[]);const[J,M]=l.useState(null),[P,I]=l.useState(""),[k,m]=l.useState({}),S=ie(),{getPathWithTable:h}=ue();l.useEffect(()=>{let p=!1;const W=async()=>{try{const F=await Promise.all(i.map(async R=>{const f=R.name||R.id||JSON.stringify(R),O=R.image||R.imageURL||R.imageUrl||R.image_url||R.img||"";if(!O)return[f,""];try{if(O.startsWith("gs://")){const T=await de(O);return T?[f,T]:(console.warn("Cart: resolveImageUrl returned no URL for",O,"item=",R.name||R.id),[f,""])}if(!O.startsWith("http://")&&!O.startsWith("https://")&&!O.startsWith("data:")&&!O.startsWith("blob:")){const T=await de(O);if(T)return[f,T]}return[f,O]}catch(T){return console.warn("Cart: error resolving image",O,T),[f,""]}}));if(p)return;const $=Object.fromEntries(F.filter(Boolean));m($)}catch{}};return i&&i.length&&W(),()=>{p=!0}},[i]),l.useEffect(()=>{let p=!1;const W=async()=>{try{const F=await Promise.all(A.map(async R=>{var O;const f=(O=R==null?void 0:R.item)==null?void 0:O.image;if(!f)return null;try{if(f.startsWith&&f.startsWith("gs://")){const T=await de(f);return T?{id:R.id,url:T}:(console.warn("Cart: resolveImageUrl returned no URL for orderHistory item image",f,"orderId=",R.id),null)}if(!f.startsWith("http://")&&!f.startsWith("https://")&&!f.startsWith("data:")&&!f.startsWith("blob:")){const T=await de(f);if(T)return{id:R.id,url:T}}}catch(T){console.warn("Cart: error resolving orderHistory image",f,T)}return null}));if(p)return;const $=new Map(F.filter(Boolean).map(R=>[R.id,R.url]));if($.size===0)return;E(R=>R.map(f=>({...f,item:{...f.item,image:$.get(f.id)||f.item.image}})))}catch{}};return A&&A.length&&W(),()=>{p=!0}},[A]);const y=()=>{S(h("/menu"))},w=(p,W)=>{M(p),I(W)},L=p=>{c(p,P),M(null)},D=()=>{M(null),I("")},d=()=>{S(h("/payments"))};return e.jsxs("div",{className:"cart-container",children:[e.jsxs("header",{className:"cart-header",children:[e.jsx("div",{className:"back-icon",onClick:()=>{r?r():S(h("/menu"))},children:e.jsx(He,{size:20})}),e.jsx("h1",{className:"cart-title",children:"Your Cart"})]}),e.jsxs("div",{className:"cart-tabs",children:[e.jsx("div",{className:`tab-item ${t==="Current Order"?"active":""}`,onClick:()=>s("Current Order"),children:"Current Order"}),e.jsx("div",{className:`tab-item ${t==="Order Track"?"active":""}`,onClick:()=>s("Order Track"),children:"Order Track"})]}),e.jsx("div",{className:"divider"}),t==="Current Order"?i.length===0?e.jsxs("div",{className:"empty-cart",children:[e.jsx("p",{className:"empty-text",children:"Your cart is empty"}),e.jsx("button",{className:"continue-btn",onClick:y,children:"Continue Shopping"})]}):e.jsxs("div",{className:"cart-content",children:[i.map((p,W)=>e.jsxs("div",{className:"cart-item",children:[e.jsx("img",{src:k[p.name]&&k[p.name]!==""?k[p.name]:p.image&&!(p.image.startsWith&&p.image.startsWith("gs://"))?p.image:re("No Image"),alt:p.name,className:"cart-item-image",onError:F=>{console.warn("Cart image load failed",F.currentTarget.src,"item=",p&&(p.id||p.name)),F.currentTarget.src=re("No Image")}}),e.jsxs("div",{className:"cart-item-details",children:[e.jsx("h3",{className:"cart-item-name",children:p.name}),e.jsx("p",{className:"cart-item-price",children:`₹${(parseFloat(String(p.price||"").replace(/[^0-9.\-]/g,""))||0).toFixed(2)}`}),e.jsxs("div",{className:"cart-item-controls",children:[e.jsxs("div",{className:"quantity-controls",children:[e.jsx("button",{className:"qty-btn",onClick:()=>u(p.name,p.quantity-1),children:e.jsx(Te,{size:16})}),e.jsx("span",{className:"qty-value",children:p.quantity}),e.jsx("button",{className:"qty-btn",onClick:()=>u(p.name,p.quantity+1),children:e.jsx(Ee,{size:16})})]}),e.jsx("button",{className:"remove-btn",onClick:()=>v(p.name),children:"Remove"})]}),e.jsx("div",{className:"instructions-section",children:J===p.name?e.jsxs("div",{className:"edit-instructions",children:[e.jsx("textarea",{value:P,onChange:F=>I(F.target.value),placeholder:"Add instructions...",rows:2}),e.jsxs("div",{className:"edit-buttons",children:[e.jsx("button",{onClick:()=>L(p.name),children:"Save"}),e.jsx("button",{onClick:D,children:"Cancel"})]})]}):e.jsx("div",{className:"instructions-display",children:p.instructions?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Instructions:"})," ",p.instructions]}),e.jsxs("button",{className:"edit-instructions-btn",onClick:()=>w(p.name,p.instructions),children:[e.jsx(Fe,{size:14})," Edit"]})]}):e.jsxs("button",{className:"edit-instructions-btn",onClick:()=>w(p.name,""),children:[e.jsx(Fe,{size:14})," Add Instructions"]})})})]})]},W)),e.jsxs("div",{className:"cart-total",children:[e.jsxs("h3",{children:["Total: ₹",C()]}),e.jsx("button",{className:"checkout-btn",onClick:d,children:"Proceed to Checkout"})]})]}):e.jsx("div",{className:"order-track-content",children:e.jsx("div",{className:"order-track-list",children:A.length===0?e.jsx("p",{className:"empty-text",children:"No orders to track"}):A.map(p=>e.jsx("div",{className:"order-track-item",children:e.jsxs("div",{className:"track-status",children:[e.jsxs("div",{className:`status-indicator ${p.status.toLowerCase()}`,children:[p.status==="Pending"&&"⏳",p.status==="Preparing"&&"👨‍🍳",p.status==="Ready"&&"✅",p.status==="Delivered"&&"🚚",p.status==="Paid"&&"💳"]}),e.jsxs("div",{className:"status-details",children:[e.jsxs("h4",{children:["Order #",p.id]}),e.jsx("p",{className:"status-text",children:p.status}),e.jsx("p",{className:"timestamp",children:p.timestamp.toLocaleString()})]})]})},p.id))})}),e.jsx(Ie,{onCartClick:()=>S(h("/cart")),onHomeClick:()=>S(h("/menu")),onProfileClick:()=>S(h("/profile"))})]})}function Gt(){const r=ie(),{orderHistory:t}=ge(),{getPathWithTable:s}=ue(),[i,u]=l.useState(!1),[c,v]=l.useState(0),[C,A]=l.useState(""),[E,U]=l.useState(!1),[J,M]=l.useState(""),I=(()=>{try{const _=sessionStorage.getItem("pendingOrderId"),a=localStorage.getItem("orderin_countercode_orderId")||localStorage.getItem("orderin_orderId"),N=_||a||null;let j=null;return N&&Array.isArray(t)&&(j=t.find(n=>String(n.id)===String(N))),!j&&Array.isArray(t)&&t.length&&(j=t[t.length-1]),j||{id:`local-${Date.now()}`,tableNo:localStorage.getItem("tableNumber")||1,items:[{name:"Sample Item",price:"0.00"}],subtotal:"0.00",taxes:"0.00",total:"0.00",paymentMethod:"Cash",createdAt:new Date().toISOString()}}catch(_){return console.warn("resolveOrder error",_),{id:`local-${Date.now()}`,tableNo:localStorage.getItem("tableNumber")||1,items:[{name:"Sample Item",price:"0.00"}],subtotal:"0.00",taxes:"0.00",total:"0.00",paymentMethod:"Cash",createdAt:new Date().toISOString()}}})(),k=I.id;I.tableNo||localStorage.getItem("tableNumber");const m=Array.isArray(I.items)&&I.items.length?I.items:[{name:"Sample Item",price:"0.00",quantity:1}],S=I.subtotal??I.sub_total??I.subtotalAmount??null,h=I.taxes??I.tax??I.taxesAmount??"0.00",y=I.total??I.amount??I.totalAmount??"0.00",w=I.paymentMethod||I.payment||"Cash",L=I.createdAt||I.time||new Date().toISOString(),D=parseFloat(h),d=parseFloat(y)||0,p=m.reduce((_,a)=>{const N=parseFloat(a.price)||0,j=parseInt(a.quantity??a.qty??1,10)||1;return _+N*j},0),W=S!=null&&parseFloat(S)||p,F=Math.max(1,Math.ceil(W/100)),$=D||D===0?D:F,R=d||W+$,f=(_,a)=>{try{const N="orderin_txns",j=localStorage.getItem(N),n=j?JSON.parse(j):{};if(n&&n[_])return n[_];const o=(a||"TX").toString().toUpperCase().replace(/\s+/g,"").replace(/[^A-Z0-9]/g,"")||"TX";let g=null;typeof crypto<"u"&&crypto.randomUUID?g=crypto.randomUUID():g=Date.now().toString(36)+Math.floor(Math.random()*9e5+1e5).toString(36);const x=`${o}-${g}`;n[_]=x;try{localStorage.setItem(N,JSON.stringify(n))}catch(b){console.warn("Could not persist transaction map",b)}return x}catch(N){return console.warn("getOrCreateTransactionId failed",N),`${w.toUpperCase().replace(/\s+/g,"")}-${Date.now()}`}},O=I.transactionId||f(k,w),T=()=>{(async()=>{let _=!1;try{M(""),U(!0);const a=JSON.parse(localStorage.getItem("user"));if(!a||!a.phone){const o="No logged-in user (missing phone). Please log in to save feedback.";console.warn("submitFeedback:",o),M(o),_=!0;return}const N=a.phone,j=te(Z,"Restaurant","orderin_restaurant_1","customers",N);console.log("Bill.submitFeedback: user=",a,"saving to",j.path);const n={stars:c,text:C||"",createdAt:new Date().toISOString()};try{if((await ae(j)).exists())try{await Ge(j,{feedback:je(n),updatedAt:pe()}),console.log("Bill: updated feedback for",N,n)}catch(g){console.warn("Bill: updateDoc failed, falling back to setDoc merge",g),await ce(j,{feedback:je(n),updatedAt:pe()},{merge:!0}),console.log("Bill: setDoc merge saved feedback for",N)}else await ce(j,{feedback:[n],createdAt:pe(),updatedAt:pe()},{merge:!0}),console.log("Bill: created customer doc and saved feedback for",N)}catch(o){console.error("Bill: error saving feedback to Firestore",o),M(String((o==null?void 0:o.message)||o)),_=!0}}catch(a){console.error("Error saving feedback:",a),M(String((a==null?void 0:a.message)||a)),_=!0}finally{if(U(!1),_)return;r(s("/menu"))}})()},B=()=>{const _=document.getElementById("bill-content");if(!_)return;const a=_.cloneNode(!0),N=a.querySelector(".actions");N&&N.remove();const j=document.createElement("div");j.style.position="fixed",j.style.left="-10000px",j.appendChild(a),document.body.appendChild(j);const n={margin:.2,filename:`receipt-${O}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};Nt().set(n).from(a).save().then(()=>{document.body.removeChild(j)}).catch(o=>{console.error("Error generating PDF",o),document.body.removeChild(j)})},q=()=>{const _=document.getElementById("bill-content");if(!_)return;const a=_.cloneNode(!0),N=a.querySelector(".actions");N&&N.remove();const n=`<style>${document.getElementById("bill-styles")?document.getElementById("bill-styles").innerText:""}</style>`,o=window.open("","_blank","toolbar=0,location=0,menubar=0");if(!o){alert("Popup blocked. Allow popups for this site to print the bill.");return}o.document.open(),o.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>Receipt</title>${n}</head><body>${a.outerHTML}</body></html>`),o.document.close(),setTimeout(()=>{o.focus(),o.print()},300)};return e.jsxs("div",{className:"bill-container",children:[e.jsx("div",{id:"bill-styles",style:{display:"none"},children:`.receipt { width: 320px; max-width: 88vw; margin: 20px auto; font-family: 'Courier New', Courier, monospace; color: #111; background: #fff; padding: 14px 18px; }
.receipt .business { text-align: center; font-weight: 700; font-size: 18px; letter-spacing: 1px; }
.receipt .address { text-align: center; font-size: 12px; margin-top: 6px; color: #333 }
.receipt .dotted { border-top: 2px dotted #444; margin: 10px 0; }
.receipt .items { font-size: 13px; margin-top: 6px; }
.receipt .item-row { display: flex; justify-content: space-between; gap: 8px; }
.receipt .item-name { flex: 1 1 auto; }
.receipt .item-price { width: 70px; text-align: right; }
.receipt .leaders { flex: 0 1 8px; text-align: center; color: #666 }
.receipt .summary { margin-top: 8px; font-size: 13px; }
.receipt .summary .row { display:flex; justify-content:space-between; margin:4px 0; }
.receipt .total { font-weight: 700; font-size: 16px; margin-top: 6px; display:flex; justify-content:space-between }
.receipt .paid-by { margin-top: 8px; display:flex; justify-content:space-between; font-size:13px }
.receipt .meta { font-size:11px; color:#333; margin-top:10px }
.receipt .thankyou { text-align:center; font-weight:700; margin-top:12px }
.receipt .small { font-size:11px }
.receipt .actions { display:flex; gap:8px; margin-top:12px }
.receipt .btn { flex:1; padding:8px 10px; border-radius:6px; border:1px solid #111; background:transparent; cursor:pointer; font-weight:600 }
.receipt .btn-primary { background:#111; color:#fff }
`}),e.jsx("div",{className:"bill-card",id:"bill-content",children:e.jsxs("div",{className:"receipt",children:[e.jsx("div",{className:"business",children:"BUSINESS NAME"}),e.jsxs("div",{className:"address small",children:["1234 Main Street",e.jsx("br",{}),"Suite 567",e.jsx("br",{}),"City Name, State 54321",e.jsx("br",{}),"123-456-7890"]}),e.jsx("div",{className:"dotted"}),e.jsx("div",{className:"items",children:m.map((_,a)=>{const N=parseFloat(String(_.price||"").replace(/[^0-9.\-]/g,""))||0,j=parseInt(_.quantity??_.qty??1,10)||1,n=(N*j).toFixed(2);return e.jsxs("div",{className:"item-row",children:[e.jsx("div",{className:"item-name",children:_.name}),e.jsxs("div",{className:"item-qty",children:[j," x ₹",N.toFixed(2)]}),e.jsxs("div",{className:"item-price",children:["₹",n]})]},a)})}),e.jsx("div",{className:"dotted"}),e.jsxs("div",{className:"summary",children:[e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"Sub Total"}),e.jsxs("span",{children:["₹",W.toFixed(2)]})]}),e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"Sales Tax"}),e.jsxs("span",{children:["₹",$.toFixed(2)]})]}),e.jsxs("div",{className:"total",children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{children:["₹",R.toFixed(2)]})]})]}),e.jsx("div",{className:"dotted"}),e.jsxs("div",{className:"paid-by",children:[e.jsx("span",{children:"Paid By:"}),e.jsx("span",{children:w})]}),e.jsxs("div",{className:"meta small",children:[e.jsx("div",{children:(()=>{try{const _=new Date(L);return`${_.toLocaleDateString()} ${_.toLocaleTimeString()}`}catch{return L}})()}),e.jsxs("div",{children:["Transaction ID: ",O]}),e.jsxs("div",{children:["Order ID: ",k]})]}),e.jsx("div",{className:"dotted"}),e.jsx("div",{className:"thankyou",children:"Thank You For Supporting Local Business!"}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",onClick:()=>r(s("/menu")),children:"Done"}),e.jsx("button",{className:"btn",onClick:q,children:"Print"}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:B,children:"Download"})]})]})}),i&&e.jsx("div",{className:"feedback-modal",children:e.jsxs("div",{className:"feedback-card",children:[e.jsx("h3",{children:"Rate Your Experience"}),e.jsx("div",{className:"stars",children:[1,2,3,4,5].map(_=>e.jsx(it,{size:32,fill:c>=_?"#00a693":"none",stroke:"#00a693",onClick:()=>v(_),style:{cursor:"pointer"}},_))}),e.jsx("textarea",{placeholder:"Tell us what you think...",value:C,onChange:_=>A(_.target.value),rows:4}),e.jsx("button",{className:"submit-feedback-btn",onClick:T,children:"Submit Feedback"})]})})]})}const Xe=({isLoading:r})=>r?e.jsx("div",{className:"loading-overlay",children:e.jsx("div",{className:"loading-spinner"})}):null,Kt=async(r=new Date)=>{try{const t=r.getDate(),s=r.getMonth()+1,i=r.getFullYear()%100,u=String(t),c=String(s),v=String(i).padStart(2,"0"),C=u+c+v,A=te(Z,"Restaurant","orderin_restaurant_1","dailyOrderCounters",C),E=await ae(A);let U=0;E.exists()&&(U=E.data().count||0);const J=U+1;return await ce(A,{count:J,date:r.toISOString().split("T")[0],lastUpdated:new Date().toISOString()},{merge:!0}),console.log(`Daily counter for ${C}: incremented to ${J}`),J}catch(t){throw console.error("Error incrementing daily counter:",t),t}},Yt=async(r=new Date)=>{try{const t=await Kt(r),s=r.getDate(),i=r.getMonth()+1,u=r.getFullYear()%100,c=String(s),v=String(i),C=String(u).padStart(2,"0"),A=`ORD-${c}${v}${C}${t}`;return console.log(`Generated display order ID: ${A}`),A}catch(t){throw console.error("Error generating display order ID:",t),t}},Qt=async r=>{try{if(!r)return console.warn("deleteUnpaidOrders: phoneNumber not provided"),0;const t=te(Z,"Restaurant","orderin_restaurant_1","customers",r),s=await ae(t);if(!s.exists())return console.log("deleteUnpaidOrders: Customer document not found for",r),0;const i=s.data();let u=Array.isArray(i.pastOrders)?i.pastOrders:[];const c=u.filter(C=>C.paymentStatus==="unpaid").length;if(c===0)return console.log("deleteUnpaidOrders: No unpaid orders found for",r),0;const v=u.filter(C=>C.paymentStatus!=="unpaid");return await ce(t,{pastOrders:v},{merge:!0}),console.log(`deleteUnpaidOrders: Deleted ${c} unpaid order(s) for ${r}`),c}catch(t){throw console.error("deleteUnpaidOrders: Error deleting unpaid orders:",t),t}},Xt=async(r,t)=>{try{if(!r||!t)return console.warn("deleteUnpaidOrderById: phoneNumber or orderId not provided"),!1;const s=te(Z,"Restaurant","orderin_restaurant_1","customers",r),i=await ae(s);if(!i.exists())return console.log("deleteUnpaidOrderById: Customer document not found for",r),!1;const u=i.data();let c=Array.isArray(u.pastOrders)?u.pastOrders:[];const v=c.findIndex(A=>A.id===t);if(v===-1)return console.log("deleteUnpaidOrderById: Order not found with ID",t),!1;const C=c[v];return C.paymentStatus!=="unpaid"?(console.log(`deleteUnpaidOrderById: Order ${t} has status "${C.paymentStatus}", not deleting`),!1):(c.splice(v,1),await ce(s,{pastOrders:c},{merge:!0}),console.log(`deleteUnpaidOrderById: Deleted unpaid order ${t} for ${r}`),!0)}catch(s){throw console.error("deleteUnpaidOrderById: Error deleting order:",s),s}},we=async(r,t=null)=>{console.log("safeDeleteUnpaidOrders: Called with phoneNumber=",r,"orderId=",t);try{if(t){const s=await Xt(r,t);console.log("safeDeleteUnpaidOrders: deleteUnpaidOrderById returned",s)}else{const s=await Qt(r);console.log("safeDeleteUnpaidOrders: deleteUnpaidOrders deleted",s,"orders")}}catch(s){console.error("safeDeleteUnpaidOrders: Failed to delete unpaid orders",s)}};function Zt({onBackClick:r}){const{cartItems:t,updateQuantity:s,removeFromCart:i,getTotalPrice:u,placeOrder:c,markPaymentSuccessful:v,saveOrderTempState:C,clearOrderTempState:A}=ge(),[E,U]=l.useState(null),J=ie(),{getPathWithTable:M}=ue();l.useEffect(()=>{(async()=>{try{const p=JSON.parse(localStorage.getItem("user"));p&&p.phone&&(console.log("Payments page loaded: Deleting unpaid orders for",p.phone),await we(p.phone))}catch(p){console.error("Error cleaning up unpaid orders on page enter:",p)}})()},[]);const P=async()=>{try{const d=JSON.parse(localStorage.getItem("user"));d&&d.phone&&await we(d.phone)}catch(d){console.error("Error during order cleanup on back navigation:",d)}sessionStorage.removeItem("pendingOrderId"),sessionStorage.removeItem("pendingOrderForFirestore"),sessionStorage.removeItem("pendingVerificationCode"),localStorage.removeItem("orderin_countercode_orderId"),localStorage.removeItem("orderin_countercode_paymentMethod"),localStorage.removeItem("orderin_onlinepayment_orderId"),localStorage.removeItem("pendingVerificationCode"),r?r():J(M("/cart"))},[I,k]=l.useState(!1),[m,S]=l.useState({});l.useEffect(()=>{let d=!1;const p=async()=>{try{const W=await Promise.all(t.map(async $=>{const R=$.name||$.id||JSON.stringify($),f=$.image||$.imageURL||$.imageUrl||$.image_url||$.img||"";if(!f)return[R,""];try{if(f.startsWith("gs://")){const O=await de(f);return O?[R,O]:(console.warn("Payments: resolveImageUrl returned no URL for",f,"item=",$.name||$.id),[R,""])}if(!f.startsWith("http://")&&!f.startsWith("https://")&&!f.startsWith("data:")&&!f.startsWith("blob:")){const O=await de(f);if(O)return[R,O]}return[R,f]}catch(O){return console.warn("Payments: error resolving image",f,O),[R,""]}}));if(d)return;const F=Object.fromEntries(W.filter(Boolean));S(F)}catch{}};return t&&t.length&&p(),()=>{d=!0}},[t]);const h=parseFloat(u()),y=h*.04,w=h+y,L=d=>{U(d)},D=async()=>{if(!E){alert("Please select a payment method");return}let d,p=null,W=null;try{k(!0);const F=JSON.parse(localStorage.getItem("user")),$=localStorage.getItem("tableNumber")||"1";if(!F||!F.phone)throw new Error("User not logged in or phone number missing");W=F.phone;const R=te(Z,"Restaurant","orderin_restaurant_1","customers",W),f=await ae(R);let O=[];if(f.exists()){const n=f.data();O=Array.isArray(n.pastOrders)?n.pastOrders:[]}let T=null;try{if(T=await Yt(),!T)throw new Error("generateDisplayOrderId returned empty value");console.log("Generated order ID:",T)}catch(n){console.warn("Failed to generate order ID, creating fallback:",n),T=`ORD-${new Date().getTime()}`,console.log("Using fallback order ID:",T)}if(!T)throw new Error("Failed to generate order ID: orderId is undefined");const B=parseFloat(u()),q=B*.04,_=B+q;if(console.log("Calculated - Subtotal:",B,"Tax:",q,"Total:",_),d=c(E),console.log("Order created from placeOrder():",d),!d)throw new Error("placeOrder() returned null or undefined");d.id=T,d.subtotal=B,d.taxes=q,d.total=_,console.log("Order updated with calculated values - Subtotal:",d.subtotal,"Taxes:",d.taxes,"Total:",d.total);let a=null;(E==="Cash"||E==="Card")&&(a=Math.floor(Math.random()*1e4).toString().padStart(4,"0"));try{a?(sessionStorage.setItem("pendingVerificationCode",a),localStorage.setItem("pendingVerificationCode",a),console.log("Payments: generated verificationCode saved to sessionStorage/localStorage=",a)):(sessionStorage.removeItem("pendingVerificationCode"),localStorage.removeItem("pendingVerificationCode"))}catch(n){console.warn("Payments: could not persist pendingVerificationCode",n)}const N={id:T,items:d.items.map(({name:n,price:o,quantity:g,instructions:x,specifications:b})=>({name:n,price:o,quantity:g,instructions:x||""})),subtotal:d.subtotal,taxes:d.taxes,total:d.total,paymentMethod:d.paymentMethod,status:d.status,tableNo:$,time:d.time,createdAt:new Date().toISOString(),paymentStatus:"unpaid",verificationCode:a,OnlinePayMethod:""};console.log("Order object before saving to Firestore:",N),console.log("OnlinePayMethod value:",N.OnlinePayMethod),O.push(N),console.log("Past orders array before Firestore save:",O),await ce(R,{pastOrders:O,lastOrderAt:pe()},{merge:!0}),console.log("Order saved to Firestore successfully");const j={subtotal:B,taxes:q,total:_};C(T,t,j,"unpaid"),console.log("Order saved to Firestore with id:",T,"Status: unpaid"),console.log("Saved billing:",j)}catch(F){console.error("Error during order processing:",F),p=F}finally{k(!1)}if(p&&(!d||!d.id)){console.warn("Order save failed - showing error to user:",p.message),alert("Error saving order to backend: "+p.message);return}d&&(E==="Online"?(console.log("Online payment selected, order id:",d.id),(async()=>{try{const $=te(Z,"Restaurant","orderin_restaurant_1"),R=await ae($);if(R.exists()){const f=R.data();console.log("Restaurant data fetched:",f);const O={orderId:d.id,subtotal:d.subtotal,taxes:d.taxes,total:d.total,taxRate:.04,useProvidedTax:!0,restaurantId:"orderin_restaurant_1",restaurantName:f.Restaurant_name||"Restaurant",ifscCode:f.IFSC||"",accountNumber:f.account||"",paymentMethod:E,customerPhone:W,timestamp:new Date().toISOString()};console.log("Payment data being sent:",O),sessionStorage.setItem("pendingOrderId",d.id),localStorage.setItem("orderin_onlinepayment_orderId",d.id),sessionStorage.setItem("paymentData",JSON.stringify(O)),localStorage.setItem("orderin_paymentData",JSON.stringify(O)),console.log("Payment data stored:",O),console.log("About to navigate to /online-payment"),setTimeout(()=>{console.log("Navigating now..."),J(M("/online-payment"))},100)}else console.error("Restaurant document not found"),alert("Error: Restaurant information not found. Please try again.")}catch($){console.error("Error fetching restaurant data:",$),alert("Error: Could not fetch restaurant information: "+$.message)}})()):(sessionStorage.setItem("pendingOrderId",d.id),localStorage.setItem("orderin_countercode_orderId",d.id),localStorage.setItem("orderin_countercode_paymentMethod",E),J(M("/counter-code"))))};return e.jsxs("div",{className:"payments-container",children:[e.jsx(Xe,{isLoading:I}),e.jsxs("div",{className:"payments-card",children:[e.jsx("button",{className:"close-button",onClick:P,children:e.jsx(Ae,{size:22})}),e.jsx("h2",{className:"checkout-header",children:"Checkout"}),t.map((d,p)=>e.jsxs("div",{className:"order-item",children:[e.jsx("img",{src:m[d.name]&&m[d.name]!==""?m[d.name]:d.image&&!(d.image.startsWith&&d.image.startsWith("gs://"))?d.image:re("No Image"),alt:d.name,className:"order-item-image",onError:W=>{console.warn("Payments image load failed",W.currentTarget.src,"orderItem",d&&(d.id||d.name)),W.currentTarget.src=re("No Image")}}),e.jsxs("div",{className:"order-item-details",children:[e.jsx("h3",{className:"order-item-name",children:d.name}),e.jsxs("p",{className:"order-item-price",children:["₹",(parseFloat(String(d.price||"").replace(/[^0-9.\-]/g,""))*d.quantity).toFixed(2)]}),e.jsxs("p",{className:"order-item-each",children:["₹",(parseFloat(String(d.price||"").replace(/[^0-9.\-]/g,""))||0).toFixed(2)," each"]}),d.instructions&&e.jsxs("p",{className:"order-item-instructions",children:[e.jsx("strong",{children:"Cooking Preferences:"})," ",d.instructions]})]}),e.jsxs("div",{className:"quantity-controls",children:[e.jsx("button",{onClick:()=>s(d.name,d.quantity-1),className:"qty-button",children:e.jsx(Te,{size:14})}),e.jsx("span",{className:"qty-value",children:d.quantity}),e.jsx("button",{onClick:()=>s(d.name,d.quantity+1),className:"qty-button",children:e.jsx(Ee,{size:14})}),e.jsx("button",{className:"remove-button",onClick:()=>i(d.name),children:e.jsx(lt,{size:16})})]})]},p)),e.jsxs("div",{className:"billing-breakdown",children:[e.jsx("h4",{className:"billing-header",children:"Billing Breakdown"}),e.jsxs("div",{className:"billing-row",children:[e.jsx("span",{children:"Subtotal :"}),e.jsxs("span",{children:["₹",h.toFixed(2)]})]}),e.jsxs("div",{className:"billing-row",children:[e.jsx("span",{children:"Taxes :"}),e.jsxs("span",{children:["₹",y.toFixed(2)]})]}),e.jsxs("div",{className:"billing-total",children:[e.jsx("span",{children:"Total :"}),e.jsxs("span",{children:["₹",w.toFixed(2)]})]})]}),e.jsxs("div",{className:"payment-methods",children:[e.jsx("h4",{className:"payment-header",children:"Payment Method"}),e.jsxs("div",{className:"payment-grid",children:[e.jsxs("button",{className:`payment-option ${E==="Online"?"selected":""}`,onClick:()=>L("Online"),children:[e.jsx(dt,{className:"payment-icon-online",size:22}),e.jsx("span",{className:"payment-label",children:"Online"})]}),e.jsxs("button",{className:`payment-option ${E==="Card"?"selected":""}`,onClick:()=>L("Card"),children:[e.jsx(ut,{className:"payment-icon-card",size:22}),e.jsx("span",{className:"payment-label",children:"Card"})]}),e.jsxs("button",{className:`payment-option ${E==="Cash"?"selected":""}`,onClick:()=>L("Cash"),children:[e.jsx(mt,{className:"payment-icon-cash",size:22}),e.jsx("span",{className:"payment-label",children:"Cash"})]})]})]}),e.jsx("button",{className:"place-order-btn",onClick:D,children:"Place Order"})]})]})}function er(){const r=ie(),{orderHistory:t,clearOrderTempState:s}=ge(),{getPathWithTable:i}=ue(),[u,c]=l.useState(null),[v,C]=l.useState(!0),[A,E]=l.useState(!1),[U,J]=l.useState(0),[M,P]=l.useState(""),[I,k]=l.useState(!1),[m,S]=l.useState("");return l.useEffect(()=>{(async()=>{var w,L;try{const D=JSON.parse(localStorage.getItem("user"));if(!D||!D.phone){console.log("PaymentSuccess: User not logged in, using fallback"),C(!1);return}const d=D.phone,p=te(Z,"Restaurant","orderin_restaurant_1","customers",d),W=await ae(p);if(W.exists()){const f=W.data(),T=(Array.isArray(f.pastOrders)?f.pastOrders:[]).filter(B=>B.paymentStatus==="paid").sort((B,q)=>new Date(q.createdAt)-new Date(B.createdAt))[0];if(T){console.log("PaymentSuccess: fetched paid order from backend:",T.id),c(T.id),C(!1);return}}const F=localStorage.getItem("orderin_countercode_orderId")||localStorage.getItem("orderin_orderId"),$=(w=t[t.length-1])==null?void 0:w.id,R=F||$||"N/A";console.log("PaymentSuccess: using fallback orderId=",R),c(R),C(!1)}catch(D){console.error("PaymentSuccess: Error fetching order from backend:",D);const d=localStorage.getItem("orderin_countercode_orderId")||localStorage.getItem("orderin_orderId"),p=(L=t[t.length-1])==null?void 0:L.id;c(d||p||"N/A"),C(!1)}})();const y=setTimeout(()=>{s(),console.log("PaymentSuccess: cleared temp state from localStorage")},1e3);return()=>clearTimeout(y)},[t,s]),e.jsxs("div",{className:"payment-success-container",children:[e.jsxs("div",{className:"success-card",children:[e.jsx("div",{className:"success-icon",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"#00a693",className:"success-svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{children:"Payment Successful!"}),e.jsxs("p",{className:"order-id",children:["Order ID : ",u]}),e.jsx("button",{className:"view-bill-btn",onClick:()=>r(i("/bill")),children:"View Bill"}),e.jsx("button",{className:"back-home-btn",onClick:()=>E(!0),children:"Back to Home"})]}),A&&e.jsx("div",{className:"feedback-modal",children:e.jsxs("div",{className:"feedback-card",children:[e.jsx("h3",{children:"Rate Your Experience"}),e.jsx("div",{className:"stars",children:[1,2,3,4,5].map(h=>e.jsx("svg",{onClick:()=>J(h),style:{cursor:"pointer",width:32,height:32,marginRight:6},viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 .587l3.668 7.431 8.2 1.192-5.934 5.787 1.4 8.168L12 18.896l-7.334 3.87 1.4-8.168L.132 9.21l8.2-1.192z",fill:U>=h?"#00a693":"none",stroke:"#00a693"})},h))}),e.jsx("textarea",{placeholder:"Tell us what you think...",value:M,onChange:h=>P(h.target.value),rows:4}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{className:"submit-feedback-btn",onClick:async()=>{S(""),k(!0);let h=!1;try{const y=JSON.parse(localStorage.getItem("user"));if(console.log("PaymentSuccess submitFeedback: user from localStorage=",y),!y||!y.phone){const w="No logged-in user (missing phone). Please log in to save feedback.";console.warn("PaymentSuccess submitFeedback:",w),S(w),h=!0}else{const w=y.phone,L=te(Z,"Restaurant","orderin_restaurant_1","customers",w);console.log("Attempting to save feedback to",L.path);const D={stars:U,text:M||"",createdAt:new Date().toISOString()};try{if((await ae(L)).exists())try{await Ge(L,{feedback:je(D),updatedAt:pe()}),console.log("PaymentSuccess feedback updated for",w,D)}catch(p){console.warn("updateDoc failed, falling back to setDoc merge",p),await ce(L,{feedback:je(D),updatedAt:pe()},{merge:!0}),console.log("PaymentSuccess feedback saved with setDoc merge for",w)}else await ce(L,{feedback:[D],createdAt:pe(),updatedAt:pe()},{merge:!0}),console.log("PaymentSuccess created customer doc and saved feedback for",w)}catch(d){console.error("PaymentSuccess: Firestore write failed",d),S(String((d==null?void 0:d.message)||d)),h=!0}if(!h)try{alert("Thank you — your feedback was saved.")}catch{}}}catch(y){console.error("Error saving PaymentSuccess feedback:",y),S(String((y==null?void 0:y.message)||y)),h=!0}finally{k(!1),h||(E(!1),r(i("/menu")))}},children:"Submit Feedback"}),e.jsx("button",{className:"submit-feedback-btn",onClick:()=>{E(!1),r(i("/menu"))},children:"Skip"})]}),I&&e.jsx("div",{style:{marginTop:8},children:"Saving feedback..."}),m&&e.jsxs("div",{style:{marginTop:8,color:"crimson"},children:["Error saving feedback: ",m]})]})})]})}function tr({onBackClick:r}){var I;const[t,s]=l.useState(["","","",""]),[i,u]=l.useState(null),c=ie(),{getPathWithTable:v}=ue(),{markPaymentSuccessful:C,orderHistory:A,clearOrderTempState:E}=ge();l.useEffect(()=>{const k=localStorage.getItem("orderin_countercode_orderId"),m=localStorage.getItem("orderin_countercode_paymentMethod");k&&m&&(console.log("Restored counter code page state: orderId=",k,"method=",m),u(k),sessionStorage.setItem("pendingOrderId",k))},[]);const U=async()=>{try{const k=JSON.parse(localStorage.getItem("user"));k&&k.phone&&await we(k.phone)}catch(k){console.error("Error during order cleanup on back navigation:",k)}sessionStorage.removeItem("pendingOrderId"),sessionStorage.removeItem("pendingOrderForFirestore"),localStorage.removeItem("orderin_countercode_orderId"),localStorage.removeItem("orderin_countercode_paymentMethod"),r?r():c(v("/cart"))},J=(k,m)=>{if(m.length>1)return;const S=[...t];if(S[k]=m,s(S),m&&k<3){const h=document.getElementById(`code-${k+1}`);h&&h.focus()}else if(!m&&k>0&&t[k]!==""){const h=[...t];h[k-1]="",s(h);const y=document.getElementById(`code-${k-1}`);y&&y.focus()}},M=(k,m)=>{if(m.key==="Backspace"){const S=[...t];if(S[k])m.preventDefault(),S[k]="",s(S);else if(k>0){m.preventDefault(),S[k-1]="",s(S);const h=document.getElementById(`code-${k-1}`);h&&h.focus()}}},P=async()=>{const k=t.join("").trim(),m=sessionStorage.getItem("pendingOrderId"),S=A[A.length-1],h=m||(S==null?void 0:S.id);if(!h){alert("No order found to verify");return}try{const y=JSON.parse(localStorage.getItem("user"));if(!y||!y.phone){alert("User not logged in");return}const w=y.phone,L=te(Z,"Restaurant","orderin_restaurant_1","customers",w),D=await ae(L);if(!D.exists()){alert("Customer record not found");return}const d=D.data();console.log("CounterCode: fetched customer doc for phone:",w,"data:",d),console.log("CounterCode: pastOrders length:",Array.isArray(d.pastOrders)?d.pastOrders.length:0);const W=(Array.isArray(d.pastOrders)?d.pastOrders:[]).find(a=>a.id===h);if(console.log("CounterCode: resolved firestoreOrder for id",h,W),!W){alert("Order not found in records");return}const F=a=>{if(!a||typeof a!="object")return"";const N=["verificationCode","verification_code","verification","verificationcode","code","otp"];for(const j of N)if(j in a&&a[j]!=null&&a[j]!=="")return a[j];for(const j of Object.keys(a))if(/verif|code|otp/i.test(j)&&a[j]!=null&&a[j]!=="")return a[j];for(const j of Object.keys(a)){const n=a[j];if(n&&typeof n=="object"){for(const o of Object.keys(n))if(/verif|code|otp/i.test(o)&&n[o]!=null&&n[o]!=="")return n[o]}}return""},$=sessionStorage.getItem("pendingVerificationCode"),R=localStorage.getItem("pendingVerificationCode");($||R)&&console.log("CounterCode: pending verification code available (session/local):",$,R);const f=F(W).toString(),O=a=>(a||"").toString().trim().replace(/\D/g,""),T=O(k),B=O(f);console.log("CounterCode: entered=",k,"normalized=",T,"stored=",f,"normalized=",B,"orderId=",h);const q=($||R||"").toString().trim().replace(/\D/g,"");if(q&&console.log("CounterCode: using pendingExpected from storage=",q),T===(q||B)&&T.length===4){try{const a=JSON.parse(localStorage.getItem("user"));if(a&&a.phone){const N=a.phone,j=te(Z,"Restaurant","orderin_restaurant_1","customers",N),n=await ae(j);if(n.exists()){const o=n.data();let g=Array.isArray(o.pastOrders)?o.pastOrders:[];const x=g.findIndex(b=>b.id===h);x!==-1&&(g[x].paymentStatus="paid",g[x].paidAt=new Date().toISOString(),await ce(j,{pastOrders:g},{merge:!0}),console.log("Order successfully updated to paymentStatus=paid, orderId=",h))}}}catch(a){console.error("Error updating order status to paid:",a)}sessionStorage.removeItem("pendingOrderId"),sessionStorage.removeItem("pendingVerificationCode"),localStorage.removeItem("pendingVerificationCode"),C(h),c(v("/payment-success"))}else console.warn("CounterCode mismatch: entered",T,"expected (pending/db)",q||B,"stored(db)=",B),alert(`Invalid counter code. Please try again. (entered: ${k}, expected (pending/db): ${q||f})`),s(["","","",""])}catch(y){console.error("Error verifying counter code:",y),alert("Error verifying code: "+y.message)}};return e.jsxs("div",{className:"counter-code-container",children:[e.jsx("h2",{className:"counter-code-title",children:"Checkout"}),e.jsx("div",{className:"code-entry-section",children:e.jsxs("div",{className:"code-entry-box",children:[e.jsx("div",{className:"order-details",children:e.jsxs("div",{className:"order-number",children:["Order ID",e.jsx("br",{}),"#",i||((I=A[A.length-1])==null?void 0:I.id)||"N/A"]})}),e.jsx("h3",{children:"Counter Code"}),e.jsx("div",{className:"digit-inputs",children:t.map((k,m)=>e.jsx("input",{id:`code-${m}`,type:"text",maxLength:"1",value:k,onChange:S=>J(m,S.target.value),onKeyDown:S=>M(m,S),inputMode:"numeric"},m))}),e.jsx("p",{className:"instruction-text",children:"Enter the code to verify payment"}),e.jsx("button",{className:"verify-button",onClick:P,children:"Verify"}),e.jsx("button",{className:"back-button",onClick:U,children:"Back"})]})})]})}function rr(){const r=ie(),t=ve(),{getPathWithTable:s}=ue(),{markPaymentSuccessful:i}=ge(),[u,c]=l.useState(null),[v,C]=l.useState(null),[A,E]=l.useState(!0),[U,J]=l.useState(!0),[M,P]=l.useState("https://orderin-admin.web.app/pay");l.useEffect(()=>{const k=sessionStorage.getItem("pendingOrderId"),m=localStorage.getItem("orderin_onlinepayment_orderId"),S=sessionStorage.getItem("paymentData"),h=localStorage.getItem("orderin_paymentData");U&&(console.log("=== OnlinePayment Component Mounted ==="),console.log("Location:",t.pathname,t.search),console.log("sessionStorage pendingOrderId:",k),console.log("localStorage orderin_onlinepayment_orderId:",m),console.log("sessionStorage paymentData:",S),console.log("localStorage orderin_paymentData:",h));const y=k||m,w=S?JSON.parse(S):h?JSON.parse(h):null;if(!y){console.error("ERROR: No order ID found in storage!"),E(!1);return}if(U&&(console.log("Found order ID:",y),console.log("Found payment data:",w)),c(y),C(w),w){const L=new URLSearchParams;L.append("orderId",w.orderId||""),L.append("subtotal",w.subtotal||"0"),L.append("taxes",w.taxes||"0"),L.append("total",w.total||"0"),L.append("taxRate",w.taxRate||"0.04"),L.append("useProvidedTax",w.useProvidedTax?"true":"false"),L.append("restaurantId",w.restaurantId||""),L.append("restaurantName",w.restaurantName||""),L.append("ifscCode",w.ifscCode||""),L.append("accountNumber",w.accountNumber||""),L.append("customerPhone",w.customerPhone||"");const D=`https://orderin-admin.web.app/pay?${L.toString()}`;console.log("iframe URL with params:",D),console.log("Sending to embedded page - Taxes:",w.taxes),P(D)}E(!1)},[]),l.useEffect(()=>{if(!u)return;const k=async m=>{if(console.log("[OnlinePayment] Message from origin:",m.origin),m.data&&m.data.type==="PAYMENT_METHOD_SELECTED"){const S=m.data.paymentMethod;console.log("[OnlinePayment] Payment method selected:",S);try{const h=JSON.parse(localStorage.getItem("user"));if(h&&h.phone){const y=te(Z,"Restaurant","orderin_restaurant_1","customers",h.phone),w=await ae(y);if(w.exists()){const L=w.data(),d=(Array.isArray(L.pastOrders)?L.pastOrders:[]).map(p=>p.id===u?{...p,OnlinePayMethod:S}:p);await ce(y,{pastOrders:d},{merge:!0}),console.log("[OnlinePayment] Order updated with OnlinePayMethod:",S)}}}catch(h){console.error("[OnlinePayment] Error updating payment method:",h)}}m.data&&m.data.type==="PAYMENT_SUCCESS"?(console.log("[OnlinePayment] Payment success received"),i(u),sessionStorage.removeItem("pendingOrderId"),localStorage.removeItem("orderin_onlinepayment_orderId"),sessionStorage.removeItem("paymentData"),localStorage.removeItem("orderin_paymentData"),setTimeout(()=>r(s("/payment-success")),300)):m.data&&m.data.type==="PAYMENT_CANCELLED"?(console.log("[OnlinePayment] Payment cancelled"),sessionStorage.removeItem("pendingOrderId"),localStorage.removeItem("orderin_onlinepayment_orderId"),sessionStorage.removeItem("paymentData"),localStorage.removeItem("orderin_paymentData"),setTimeout(()=>r(s("/payments")),300)):m.data&&m.data.type==="PAYMENT_ERROR"&&(console.error("[OnlinePayment] Payment error:",m.data.message),sessionStorage.removeItem("pendingOrderId"),localStorage.removeItem("orderin_onlinepayment_orderId"),sessionStorage.removeItem("paymentData"),localStorage.removeItem("orderin_paymentData"),setTimeout(()=>r(s("/payments")),300))};return window.addEventListener("message",k),()=>window.removeEventListener("message",k)},[u,r,s,i]);const I=()=>{console.log("[OnlinePayment] Back button clicked"),sessionStorage.removeItem("pendingOrderId"),localStorage.removeItem("orderin_onlinepayment_orderId"),sessionStorage.removeItem("paymentData"),localStorage.removeItem("orderin_paymentData"),r(s("/payments"))};return!A&&!u?e.jsx("div",{className:"online-payment-container",children:e.jsxs("div",{style:{backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",padding:"20px",maxWidth:"400px",textAlign:"center"},children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:"No order ID found. Cannot load payment gateway."}),e.jsx("button",{onClick:I,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Go Back to Payments"}),U&&e.jsxs("div",{style:{marginTop:"20px",textAlign:"left",fontSize:"12px",fontFamily:"monospace",backgroundColor:"#f8f9fa",padding:"10px",borderRadius:"4px"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Debug Info:"})}),e.jsxs("p",{children:["Location: ",t.pathname,t.search]}),e.jsxs("p",{children:["Session pendingOrderId: ",sessionStorage.getItem("pendingOrderId")||"NOT FOUND"]}),e.jsxs("p",{children:["Local orderin_onlinepayment_orderId: ",localStorage.getItem("orderin_onlinepayment_orderId")||"NOT FOUND"]})]})]})}):A?e.jsx("div",{className:"online-payment-container",children:e.jsx("div",{className:"payment-loading",children:"Loading payment gateway..."})}):e.jsxs("div",{className:"online-payment-container",children:[e.jsx("button",{className:"payment-back-button",onClick:I,title:"Go back to payments",children:e.jsx(Ae,{size:24})}),e.jsxs("div",{style:{position:"absolute",top:"20px",right:"20px",fontSize:"12px",color:"#666",zIndex:999},children:["Order: ",u,v&&e.jsxs("div",{children:["Total: ₹",v.total]})]}),e.jsx("iframe",{src:M,title:"Online Payment Gateway",className:"payment-iframe",allow:"payment",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation"})]})}function me({children:r}){const t=localStorage.getItem("user");return t!=null?r:e.jsx(Je,{to:"/",replace:!0})}const ar=()=>{const r=ie(),t=ve(),s=l.useRef(0),i=l.useRef(null);l.useEffect(()=>{const u=["/cart","/bill","/payments","/counter-code","/payment-success"],c=["/payments","/counter-code"],v=t.pathname,A=(J=>{if(J==="/")return console.log("[useGlobalBackButton] Login page - prevent back"),{action:"prevent",target:null,requiresCleanup:!1};if(J==="/menu")return console.log("[useGlobalBackButton] Menu page - go to login"),{action:"redirect",target:"/",requiresCleanup:!1};if(u.some(M=>J.startsWith(M))){const M=c.some(P=>J.startsWith(P));return console.log("[useGlobalBackButton] Payment flow page:",J,"- requiresCleanup:",M),{action:"allowNormal",target:null,requiresCleanup:M}}else return console.log("[useGlobalBackButton] Other page:",J,"- go to menu"),{action:"redirect",target:"/menu",requiresCleanup:!1}})(v);i.current&&window.removeEventListener("popstate",i.current);const E=++s.current;window.history.pushState({orderinState:E,path:v,behavior:A.action,target:A.target,requiresCleanup:A.requiresCleanup},null);const U=J=>{const M=J.state;M!=null&&M.orderinState?(M.requiresCleanup&&(console.log("Global back handler: Cleanup required from",M.path),(async()=>{try{const I=JSON.parse(localStorage.getItem("user"));I&&I.phone&&(console.log("Global back handler: Starting cleanup for",I.phone),await we(I.phone),console.log("Global back handler: Cleanup completed"),sessionStorage.removeItem("pendingOrderId"),sessionStorage.removeItem("pendingOrderForFirestore"),localStorage.removeItem("orderin_countercode_orderId"),localStorage.removeItem("orderin_countercode_paymentMethod"))}catch(I){console.error("Global back handler: Cleanup error (non-blocking):",I)}})()),M.behavior==="prevent"?window.history.pushState(M,null):M.behavior==="redirect"&&M.target&&r(M.target,{replace:!0})):M||r("/menu",{replace:!0})};return window.addEventListener("popstate",U),i.current=U,()=>{window.removeEventListener("popstate",U)}},[t.pathname,r])};function nr({isLoading:r,setIsLoading:t}){return ar(),e.jsxs("div",{className:"App",children:[e.jsx(Xe,{isLoading:r}),e.jsxs(pt,{children:[e.jsx(le,{path:"/",element:e.jsx(kt,{setIsLoading:t})}),e.jsx(le,{path:"/menu",element:e.jsx(me,{children:e.jsx(zt,{setIsLoading:t})})}),e.jsx(le,{path:"/help",element:e.jsx(me,{children:e.jsx(Wt,{setIsLoading:t})})}),e.jsx(le,{path:"/about",element:e.jsx(me,{children:e.jsx($t,{setIsLoading:t})})}),e.jsx(le,{path:"/about-orderin",element:e.jsx(me,{children:e.jsx(qt,{setIsLoading:t})})}),e.jsx(le,{path:"/item/:slug",element:e.jsx(me,{children:e.jsx(Ht,{setIsLoading:t})})}),e.jsx(le,{path:"/profile",element:e.jsx(me,{children:e.jsx(Jt,{setIsLoading:t})})}),e.jsx(le,{path:"/cart",element:e.jsx(me,{children:e.jsx(Vt,{setIsLoading:t})})}),e.jsx(le,{path:"/bill",element:e.jsx(me,{children:e.jsx(Gt,{setIsLoading:t})})}),e.jsx(le,{path:"/payments",element:e.jsx(me,{children:e.jsx(Zt,{setIsLoading:t})})}),e.jsx(le,{path:"/payment-success",element:e.jsx(me,{children:e.jsx(er,{setIsLoading:t})})}),e.jsx(le,{path:"/counter-code",element:e.jsx(me,{children:e.jsx(tr,{setIsLoading:t})})}),e.jsx(le,{path:"/online-payment",element:e.jsx(me,{children:e.jsx(rr,{setIsLoading:t})})}),e.jsx(le,{path:"*",element:e.jsx(Je,{to:"/menu",replace:!0})})]})]})}function sr(){const[r,t]=l.useState(!1);return e.jsx(gt,{children:e.jsx(nr,{isLoading:r,setIsLoading:t})})}const or=ht.createRoot(document.getElementById("root"));or.render(e.jsx(qe.StrictMode,{children:e.jsx(Dt,{children:e.jsx(sr,{})})}));
